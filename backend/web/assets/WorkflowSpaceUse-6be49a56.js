import{c as t,A as ge,j as Me,U as Pe,J as ve,r as w,K as Be,H as qe,I as Je,L as Ge,M as B,N as S,k as ae,e as le,ar as He,b as Ze,l as n,m as Qe,p as o,v as m,q as v,s as l,y as h,z as k,u as r,B as W,x as j,F as E,G as $,V as q,D as V,Q as oe,C as Xe,as as Ye,at as we}from"./index-79832f00.js";import{u as Ke}from"./userDatabase-3d15dc66.js";import{F as et,T as tt,_ as at,a as lt,b as ot,c as st,d as rt}from"./EchartsRenderer-d7e54f2c.js";import{_ as nt}from"./UploaderFieldUse-27de10a8.js";import{_ as ut}from"./TemperatureInput-cc406102.js";import{_ as ct}from"./WorkflowRunRecordsDrawer-d59e96ed.js";import{d as it}from"./database-b09bd809.js";import{_ as pt}from"./_plugin-vue_export-helper-c27b6911.js";var dt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M391 240.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L200 146.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L280 333.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L401 410c5.1.6 9.5-3.7 8.9-8.9L391 240.9zm10.1 373.2L240.8 633c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L146.3 824a8.03 8.03 0 000 11.3l42.4 42.3c3.1 3.1 8.2 3.1 11.3 0L333.7 744l43.7 43.7A8.01 8.01 0 00391 783l18.9-160.1c.6-5.1-3.7-9.4-8.8-8.8zm221.8-204.2L783.2 391c6.6-.8 9.4-8.9 4.7-13.6L744 333.6 877.7 200c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.3a8.03 8.03 0 00-11.3 0L690.3 279.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L614.1 401c-.6 5.2 3.7 9.5 8.8 8.9zM744 690.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L623 614c-5.1-.6-9.5 3.7-8.9 8.9L633 783.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L824 877.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L744 690.4z"}}]},name:"fullscreen-exit",theme:"outlined"};const _t=dt;function ke(p){for(var a=1;a<arguments.length;a++){var c=arguments[a]!=null?Object(arguments[a]):{},b=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(c).filter(function(x){return Object.getOwnPropertyDescriptor(c,x).enumerable}))),b.forEach(function(x){ft(p,x,c[x])})}return p}function ft(p,a,c){return a in p?Object.defineProperty(p,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):p[a]=c,p}var se=function(a,c){var b=ke({},a,c.attrs);return t(ge,ke({},b,{icon:_t}),null)};se.displayName="FullscreenExitOutlined";se.inheritAttrs=!1;const mt=se;var vt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M290 236.4l43.9-43.9a8.01 8.01 0 00-4.7-13.6L169 160c-5.1-.6-9.5 3.7-8.9 8.9L179 329.1c.8 6.6 8.9 9.4 13.6 4.7l43.7-43.7L370 423.7c3.1 3.1 8.2 3.1 11.3 0l42.4-42.3c3.1-3.1 3.1-8.2 0-11.3L290 236.4zm352.7 187.3c3.1 3.1 8.2 3.1 11.3 0l133.7-133.6 43.7 43.7a8.01 8.01 0 0013.6-4.7L863.9 169c.6-5.1-3.7-9.5-8.9-8.9L694.8 179c-6.6.8-9.4 8.9-4.7 13.6l43.9 43.9L600.3 370a8.03 8.03 0 000 11.3l42.4 42.4zM845 694.9c-.8-6.6-8.9-9.4-13.6-4.7l-43.7 43.7L654 600.3a8.03 8.03 0 00-11.3 0l-42.4 42.3a8.03 8.03 0 000 11.3L734 787.6l-43.9 43.9a8.01 8.01 0 004.7 13.6L855 864c5.1.6 9.5-3.7 8.9-8.9L845 694.9zm-463.7-94.6a8.03 8.03 0 00-11.3 0L236.3 733.9l-43.7-43.7a8.01 8.01 0 00-13.6 4.7L160.1 855c-.6 5.1 3.7 9.5 8.9 8.9L329.2 845c6.6-.8 9.4-8.9 4.7-13.6L290 787.6 423.7 654c3.1-3.1 3.1-8.2 0-11.3l-42.4-42.4z"}}]},name:"fullscreen",theme:"outlined"};const wt=vt;function ye(p){for(var a=1;a<arguments.length;a++){var c=arguments[a]!=null?Object(arguments[a]):{},b=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(b=b.concat(Object.getOwnPropertySymbols(c).filter(function(x){return Object.getOwnPropertyDescriptor(c,x).enumerable}))),b.forEach(function(x){kt(p,x,c[x])})}return p}function kt(p,a,c){return a in p?Object.defineProperty(p,a,{value:c,enumerable:!0,configurable:!0,writable:!0}):p[a]=c,p}var re=function(a,c){var b=ye({},a,c.attrs);return t(ge,ye({},b,{icon:wt}),null)};re.displayName="FullscreenOutlined";re.inheritAttrs=!1;const yt=re;const gt={key:0,class:"space-container"},ht=["src"],bt=["src"],St={key:0},xt={key:0},Ot={key:1},Lt={key:2},Ut={key:3},Ft={key:4},It={key:5},Dt={key:6},$t={key:0},Vt={__name:"WorkflowSpaceUse",setup(p){const{t:a}=Me(),c=Pe(),{language:b,setting:x}=ve(c),ne=Ke(),{userDatabases:he}=ve(ne),ue=w(!0),be=w(!1),ce=Be(),J=qe(),G=Je(),H=J.params.workflowId,Z=w(!1),Se=w(window.innerWidth<=768?"90vw":"60vw"),O=w(!1),N=w([]),A=w([]),z=w([]);Ge(async()=>{const y=B("get",{wid:H}),d=it("list",{}),g=await y,s=await d;if(s.status==200&&ne.setUserDatabases(s.data),g.status!=200){S.error(a("workspace.workflowSpace.get_workflow_failed")),G.push({name:"WorkflowSpaceMain"});return}i.value=g.data,i.value.data.nodes.forEach(D=>{D.category=="vectorDb"&&(D.data.template.database.options=he.value.filter(I=>I.status=="VALID").map(I=>({value:I.vid,label:I.name})))});const _=ae(i.value),u=le(_);if(N.value=u.inputFields,A.value=u.outputNodes,z.value=u.triggerNodes,Q.value=JSON.parse(JSON.stringify(i.value)),J.query.rid){const I=await He("get",{rid:J.query.rid});try{pe(I.data)}catch{S.error(a("workspace.workflowSpace.get_workflow_record_failed"))}}ue.value=!1});const i=w({}),Q=w({}),U=w(!1),X=w(null),M=w(null),xe=async()=>{M.value=null,Y.value=!1;let y=!0;try{N.value.forEach(s=>{let _=!0;s.field_type!="checkbox"&&s.show&&s.required&&((s.field_type=="file"&&s.value.length==0||s.field_type=="number"&&typeof s.value!="number"||!s.value&&!s.value===0)&&(_=!1),_||(S.error(a("workspace.workflowSpace.field_is_empty",{field:s.display_name})),y=!1))})}catch{y=!1}if(!y)return;let d=JSON.parse(JSON.stringify(Q.value));d.data.nodes.forEach(s=>{s.data.has_inputs&&Ye(s)&&!["triggers"].includes(s.category)&&Object.keys(s.data.template).forEach(_=>{s.data.template[_].show&&(s.data.template[_].value=i.value.data.nodes.find(u=>u.id==s.id).data.template[_].value)})}),U.value=!0,d.data.setting=x.value.data;const g=await B("run",d);g.status==200?(S.success(a("workspace.workflowSpace.submit_workflow_success")),M.value=g.data.rid,X.value=setInterval(async()=>{const s=await B("check_status",{rid:M.value});if(s.status==200){S.success(a("workspace.workflowSpace.run_workflow_success")),clearInterval(X.value),U.value=!1,i.value=s.data;const _=ae(i.value),u=le(_);N.value=u.inputFields,A.value=u.outputNodes,z.value=u.triggerNodes}else s.status==500&&(U.value=!1,S.error(a("workspace.workflowSpace.run_workflow_failed")),clearInterval(X.value))},1e3)):(S.error(a("workspace.workflowSpace.submit_workflow_failed")),U.value=!1)},Oe=async()=>{U.value=!0,(await we("update",{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,...i.value})).status==200?S.success(a("workspace.workflowSpace.update_schedule_success")):S.error(a("workspace.workflowSpace.update_schedule_failed")),U.value=!1},ie=w(!1),Le=async()=>{ie.value=!0,(await we("delete",{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,...i.value})).status==200?S.success(a("workspace.workflowSpace.delete_schedule_success")):S.error(a("workspace.workflowSpace.delete_schedule_failed")),ie.value=!1},Ue=async()=>{(await B("delete",{wid:i.value.wid})).status==200?(S.success(a("workspace.workflowSpace.delete_success")),ce.deleteUserWorkflow(i.value.wid),ce.deleteUserWorkflow(i.value.wid,!0),G.push({name:"WorkflowSpaceMain"})):S.error(a("workspace.workflowSpace.delete_failed"))},Fe=()=>{G.push({name:"WorkflowEditor",params:{workflowId:H}})},Y=w(!1),R=w(""),K=w(""),Ie=Ze(()=>R.value=="FINISHED"?"success":R.value=="FAILED"?"error":"info"),pe=y=>{M.value=y.rid,R.value=y.status,i.value.data={...y.data,ui:Q.value.data.ui||{}};let[d,g]=(y.data.error_task||".").split(".");d=d.split("_").map((u,D)=>D===0?u.charAt(0).toLowerCase()+u.slice(1):u.charAt(0).toUpperCase()+u.slice(1)).join(""),g=g.split("_").map(u=>u.charAt(0).toUpperCase()+u.slice(1)).join(""),g=="OpenAi"?g="OpenAI":g=="ChatGlm"&&(g="ChatGLM"),K.value=`${d}.${g}`;const s=ae(i.value),_=le(s);N.value=_.inputFields,A.value=_.outputNodes,z.value=_.triggerNodes,Y.value=!0},De=y=>{window.pywebview.api.open_local_file(y)};return(y,d)=>{const g=n("a-skeleton"),s=n("a-typography-title"),_=n("a-typography-text"),u=n("a-divider"),D=n("a-carousel"),I=n("a-modal"),ee=n("a-typography-link"),$e=n("a-tag"),te=n("a-space"),L=n("a-col"),T=n("a-button"),de=n("a-popconfirm"),C=n("a-row"),Ve=n("a-alert"),Ce=n("a-select"),We=n("a-textarea"),Ee=n("a-input"),Ne=n("a-input-number"),Re=n("a-checkbox"),Te=n("a-form-item"),je=n("a-form"),Ae=n("cron-ant"),ze=n("a-card"),_e=n("a-tooltip"),fe=n("a-typography-paragraph"),me=n("a-spin"),P=Qe("highlight");return ue.value?(o(),m("div",gt,[t(g,{active:""})])):(o(),v(me,{key:1,spinning:be.value,class:"space-container"},{default:l(()=>[t(C,{justify:"space-between",align:"middle"},{default:l(()=>[t(L,null,{default:l(()=>[t(s,null,{default:l(()=>[h(k(i.value.title),1)]),_:1}),t(te,null,{default:l(()=>[t(_,{type:"secondary"},{default:l(()=>[h(k(r(a)("workspace.workflowSpace.update_time",{time:new Date(i.value.update_time).toLocaleString()})),1)]),_:1}),t(u,{type:"vertical"}),t(ee,{onClick:d[1]||(d[1]=e=>Z.value=!0)},{default:l(()=>[h(k(r(a)("workspace.workflowSpace.brief"))+" ",1),t(I,{open:Z.value,title:r(a)("workspace.workflowSpace.brief"),width:Se.value,footer:null,class:"introduction-modal",onCancel:d[0]||(d[0]=e=>Z.value=!1)},{default:l(()=>[t(D,{autoplay:"",arrows:"","dots-class":"slick-dots slick-thumb"},{customPaging:l(e=>[W("a",null,[W("img",{src:i.value.images[e.i]},null,8,ht)])]),default:l(()=>[(o(!0),m(E,null,j(i.value.images,(e,F)=>(o(),m("div",{key:F},[W("img",{src:e},null,8,bt)]))),128))]),_:1}),$(t(r(q),{source:i.value.brief,class:"custom-scrollbar markdown-body custom-hljs"},null,8,["source"]),[[P]])]),_:1},8,["open","title","width"])]),_:1}),t(u,{type:"vertical"}),(o(!0),m(E,null,j(i.value.tags,(e,F)=>(o(),v($e,{color:e.color,key:F},{default:l(()=>[h(k(e.title),1)]),_:2},1032,["color"]))),128))]),_:1})]),_:1}),t(L,null,{default:l(()=>[t(te,null,{default:l(()=>[t(ct,{workflowId:r(H),onOpenRecord:pe},null,8,["workflowId"]),t(T,{onClick:Fe},{default:l(()=>[h(k(r(a)("workspace.workflowSpace.edit")),1)]),_:1}),t(de,{placement:"leftTop",title:r(a)("workspace.workflowSpace.delete_confirm"),onConfirm:Ue},{default:l(()=>[t(T,{type:"primary",danger:""},{default:l(()=>[h(k(r(a)("workspace.workflowSpace.delete")),1)]),_:1})]),_:1},8,["title"])]),_:1})]),_:1})]),_:1}),t(u),t(C,{gutter:[16,16]},{default:l(()=>[Y.value?(o(),v(L,{key:0,span:24},{default:l(()=>[t(Ve,{type:Ie.value,"show-icon":""},{message:l(()=>[W("span",null,k(r(a)("workspace.workflowSpace.record_status",{status:r(a)(`components.workspace.workflowRunRecordsDrawer.status_${R.value.toLowerCase()}`)})),1),t(u,{type:"vertical"}),R.value=="FAILED"&&K.value!="."?(o(),m("span",St,k(r(a)("workspace.workflowSpace.record_error_task",{task:r(a)("components.nodes."+K.value+".title")})),1)):V("",!0)]),_:1},8,["type"])]),_:1})):V("",!0),$(t(L,{xxl:6,xl:8,lg:10,md:24},{default:l(()=>[t(C,{gutter:[16,16]},{default:l(()=>[t(s,{level:3},{default:l(()=>[t(r(et),{class:"text-primary"}),h(" "+k(r(a)("workspace.workflowSpace.inputs")),1)]),_:1}),t(L,{span:24},{default:l(()=>[t(je,{layout:"vertical"},{default:l(()=>[(o(!0),m(E,null,j(N.value,(e,F)=>(o(),m("div",{key:`field-${e}-${F}`},[r(Xe).includes(e.field_type)?V("",!0):(o(),v(Te,{key:0},{label:l(()=>[h(k(e.display_name),1)]),default:l(()=>[e.category=="llms"&&e=="temperature"?(o(),v(ut,{key:0,modelValue:e.value,"onUpdate:modelValue":f=>e.value=f},null,8,["modelValue","onUpdate:modelValue"])):e.field_type=="select"?(o(),v(Ce,{key:1,value:e.value,"onUpdate:value":f=>e.value=f,options:e.options},null,8,["value","onUpdate:value","options"])):e.field_type=="textarea"?(o(),v(We,{key:2,value:e.value,"onUpdate:value":f=>e.value=f,autoSize:!0,showCount:!0,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.field_type=="input"?(o(),v(Ee,{key:3,value:e.value,"onUpdate:value":f=>e.value=f,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.field_type=="number"?(o(),v(Ne,{key:4,value:e.value,"onUpdate:value":f=>e.value=f,placeholder:e.placeholder},null,8,["value","onUpdate:value","placeholder"])):e.field_type=="checkbox"?(o(),v(Re,{key:5,checked:e.value,"onUpdate:checked":f=>e.value=f},null,8,["checked","onUpdate:checked"])):e.field_type=="file"?(o(),v(nt,{key:6,modelValue:e.value,"onUpdate:modelValue":f=>e.value=f},null,8,["modelValue","onUpdate:modelValue"])):e.field_type=="list"?(o(),v(at,{key:7,modelValue:e.value,"onUpdate:modelValue":f=>e.value=f},null,8,["modelValue","onUpdate:modelValue"])):V("",!0)]),_:2},1024)),e.field_type=="typography-paragraph"?(o(),v(C,{key:1},{default:l(()=>[t(L,{span:24,class:"ui-special-item-container"},{default:l(()=>[$(t(r(q),{source:e.value,class:"markdown-body custom-hljs ui-special-item"},null,8,["source"]),[[P]])]),_:2},1024)]),_:2},1024)):V("",!0)]))),128))]),_:1})]),_:1}),t(u),t(L,{span:24},{default:l(()=>[t(C,{gutter:[16,16]},{default:l(()=>[(o(!0),m(E,null,j(z.value,e=>(o(),v(L,{key:`node-${e.id}`,span:24},{default:l(()=>[e.type=="ButtonTrigger"?(o(),v(T,{key:0,type:"primary",block:"",onClick:xe,loading:U.value},{default:l(()=>[h(k(e.data.template.button_text.value),1)]),_:2},1032,["loading"])):e.type=="ScheduleTrigger"?(o(),v(ze,{key:1,title:r(a)("components.nodes.triggers.ScheduleTrigger.schedule_settings")},{extra:l(()=>[t(te,null,{default:l(()=>[t(T,{type:"primary",onClick:Oe,loading:U.value},{default:l(()=>[h(k(r(a)("components.nodes.triggers.ScheduleTrigger.save_schedule_settings")),1)]),_:1},8,["loading"]),t(de,{title:r(a)("workspace.workflowSpace.delete_schedule_trigger_confirm"),onConfirm:Le},{default:l(()=>[t(T,{type:"primary",danger:""},{default:l(()=>[h(k(r(a)("workspace.workflowSpace.delete")),1)]),_:1})]),_:1},8,["title"])]),_:1})]),default:l(()=>[t(Ae,{modelValue:e.data.template.schedule.value,"onUpdate:modelValue":F=>e.data.template.schedule.value=F,"button-props":{type:"primary",shape:"round"},locale:r(b)},null,8,["modelValue","onUpdate:modelValue","locale"])]),_:2},1032,["title"])):V("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1},512),[[oe,!O.value]]),t(L,{xxl:O.value?24:18,xl:O.value?24:16,lg:O.value?24:14,md:24},{default:l(()=>[t(s,{level:3,style:{display:"flex","justify-content":"space-between"}},{default:l(()=>[W("span",null,[t(r(tt),{class:"text-primary"}),h(" "+k(r(a)("workspace.workflowSpace.outputs")),1)]),W("span",null,[t(_e,{title:r(a)("workspace.workflowSpace.maximize_output")},{default:l(()=>[$(t(r(yt),{onClick:d[2]||(d[2]=e=>O.value=!O.value)},null,512),[[oe,!O.value]])]),_:1},8,["title"]),t(_e,{title:r(a)("workspace.workflowSpace.normalize_output")},{default:l(()=>[$(t(r(mt),{onClick:d[3]||(d[3]=e=>O.value=!O.value)},null,512),[[oe,O.value]])]),_:1},8,["title"])])]),_:1}),t(me,{spinning:U.value},{default:l(()=>[t(C,{gutter:[16,16]},{default:l(()=>[(o(!0),m(E,null,j(A.value,(e,F)=>(o(),v(L,{span:24,class:"draggable-item",key:`node-${e.id}-${F}`},{default:l(()=>{var f;return[e.type=="Text"?(o(),m("div",xt,[t(s,{level:5},{default:l(()=>[h(k(e.data.template.output_title.value),1)]),_:2},1024),e.data.template.render_markdown.value?(o(),m(E,{key:0},[$(t(r(q),{source:e.data.template.text.value,class:"markdown-body custom-hljs"},null,8,["source"]),[[P]]),t(fe,{copyable:{text:e.data.template.text.value}},null,8,["copyable"])],64)):(o(),v(fe,{key:1,copyable:{text:e.data.template.text.value}},{default:l(()=>[h(k(e.data.template.text.value),1)]),_:2},1032,["copyable"]))])):e.type=="Document"?(o(),m("div",Ot,[t(ee,{onClick:Ct=>De(e.data.template.output.value)},{default:l(()=>[h(k(e.data.template.output.value),1)]),_:2},1032,["onClick"])])):e.type=="Audio"?(o(),m("div",Lt,[t(lt,{audios:[(f=e.data.template.audio_url)==null?void 0:f.value]},null,8,["audios"])])):e.type=="Mindmap"?(o(),m("div",Ut,[t(ot,{content:e.data.template.content.value,style:{width:"100%","min-height":"50vh"}},null,8,["content"])])):e.type=="Mermaid"?(o(),m("div",Ft,[t(st,{content:e.data.template.content.value,style:{width:"100%","min-height":"50vh"}},null,8,["content"])])):e.type=="Echarts"?(o(),m("div",It,[t(rt,{option:e.data.template.option.value,style:{width:"100%","min-height":"50vh"}},null,8,["option"])])):(o(),m("div",Dt,[e.field_type=="typography-paragraph"?(o(),m("div",$t,[$(t(r(q),{source:e.value,class:"markdown-body custom-hljs ui-special-item"},null,8,["source"]),[[P]])])):V("",!0)]))]}),_:2},1024))),128))]),_:1})]),_:1},8,["spinning"])]),_:1},8,["xxl","xl","lg"])]),_:1})]),_:1},8,["spinning"]))}}},Mt=pt(Vt,[["__scopeId","data-v-deffe738"]]);export{Mt as default};
