import{I as ne,c as t,_ as ie,W as se,s as w,x as re,r as K,a as N,a1 as u,h as j,j as o,a7 as de,M as d,f as b,B as i,T as _,D as m,aN as ce,aO as ke,C as P,E as A,$ as L,a0 as C,K as R,F as ue,G as _e}from"./index-CfafZJhW.js";import{_ as me}from"./UploaderFieldUse-C5i5-QFO.js";import{c as p,a as be,r as fe}from"./database-Iqvj_Bo2.js";import{F as he}from"./FileCabinet-ZazIITah.js";import{D as ye}from"./Delete-Do6S_q1h.js";import{E as ge}from"./Edit-BiyNizmK.js";import{C as we}from"./Close-BSG83FZy.js";import{S as xe}from"./Save-DMA2iEvH.js";const ve=ne("add-item",!0,function(e){return t("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[t("path",{d:"M24 30V24",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M6 30H24H42V42H6V30Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"6",y1:"12.5",x2:"6",y2:"11.5",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"6",y1:"18",x2:"6",y2:"17",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"6",y1:"7",x2:"6",y2:"6",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"42",y1:"12.5",x2:"42",y2:"11.5",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"42",y1:"18",x2:"42",y2:"17",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"42",y1:"7",x2:"42",y2:"6",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"42",y1:"18",x2:"41",y2:"18",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"7",y1:"18",x2:"6",y2:"18",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"7",y1:"6",x2:"6",y2:"6",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"14",y1:"6",x2:"13",y2:"6",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"21",y1:"6",x2:"20",y2:"6",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"21",y1:"18",x2:"20",y2:"18",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"28",y1:"6",x2:"27",y2:"6",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"14",y1:"18",x2:"13",y2:"18",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"28",y1:"18",x2:"27",y2:"18",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"35",y1:"6",x2:"34",y2:"6",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"35",y1:"18",x2:"34",y2:"18",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("line",{x1:"42",y1:"6",x2:"41",y2:"6",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null)])}),je={key:0,class:"loading-container"},Le={key:1,class:"dataspace-container"},Ce={key:0,class:"table-mask"},pe={__name:"RelationalDatabaseTableDetail",setup(e){const{t:r}=se(),x=w(!0),W=de(),D=W.params.databaseId,y=W.params.tableId,S=w({}),f=w({}),I=w(!1),F=async()=>{const l=await be("get",{rid:D});l.status==200?S.value=l.data:u.error(l.msg)},H=async(l=!0)=>{const n=await fe("get",{tid:y,simple:l});n.status==200?(f.value=n.data,a.schema=n.data.schema):u.error(n.msg)};re(async()=>{x.value=!0,await Promise.all([F(),H()]),x.value=!1});const M=w("sheet"),$=[{title:r("workspace.databaseTableCreate.column_name"),key:"name",dataIndex:"name"},{title:r("workspace.databaseTableCreate.column_type"),key:"type",dataIndex:"type",width:"150px"},{title:r("workspace.databaseTableCreate.max_length"),key:"max_length",dataIndex:"max_length",width:"100px"}],a=K({columns:[],data:[],schema:[],loading:!1,current:1,pageSize:10,total:0,pagination:N(()=>({total:a.total,current:a.current,pageSize:a.pageSize})),handleTableChange:(l,n,k)=>{a.load({page_size:l.pageSize,page:l.current,sort_field:k.field,sort_order:k.order})},load:async l=>{a.loading=!0;const n=await p("list",{tid:y,...l});n.status==200?(a.data=n.data.records,a.columns=a.schema.columns.map(k=>({title:k.name,dataIndex:k.name,key:k.name,sorter:k.type==="int"||k.type==="float",width:150}))):n.status==500?u.error(r("workspace.databaseTableRecord.failed_to_load_database")):u.error(n.msg),a.total=n.data.total,a.pageSize=n.data.page_size,a.current=n.data.page,a.loading=!1,I.value=!0},originalData:[],editable:!1,startEdit:()=>{a.editable=!0,a.originalData=JSON.parse(JSON.stringify(a.data))},cancelEdit:()=>{a.editable=!1,a.data=a.originalData},save:async()=>{a.loading=!0;const l=await p("update",{tid:y,records:a.data});l.status==200?(u.success(r("common.save_success")),a.editable=!1):u.error(l.msg),a.loading=!1},selectedRecords:[],rowSelection:N(()=>a.editable?{preserveSelectedRowKeys:!0,onChange:(l,n)=>{a.selectedRecords=l}}:null),deleteRecords:async()=>{a.loading=!0;const l=await p("delete",{tid:y,records:a.selectedRecords});l.status==200?(u.success(r("common.save_success")),a.load(),f.value.current_rows=l.data.current_rows):u.error(l.msg),a.loading=!1}}),s=K({visible:!1,loading:!1,record:{},files:[],addMethod:"manual",open:()=>{s.visible=!0},handleOk:async()=>{s.loading=!0;const l=await p("add",{tid:y,add_method:s.addMethod,record:s.record,file:s.files[0]});l.status==200?(u.success(r("common.save_success")),s.visible=!1,a.load(),f.value.current_rows=l.data.current_rows):u.error(l.msg),s.loading=!1},handleCancel:()=>{s.visible=!1}});return(l,n)=>{const k=d("a-spin"),V=d("router-link"),T=d("a-breadcrumb-item"),J=d("a-breadcrumb"),G=d("a-typography-text"),g=d("a-tooltip"),h=d("a-button"),Z=d("a-popconfirm"),z=d("a-radio-button"),q=d("a-radio-group"),E=d("a-form-item"),O=d("a-form"),Q=d("a-input"),X=d("a-modal"),Y=d("a-space"),ee=d("a-flex"),te=d("a-typography-paragraph"),U=d("a-table"),B=d("a-tab-pane"),ae=d("a-tabs"),oe=d("a-card");return x.value?(b(),j("div",je,[t(k)])):(b(),j("div",Le,[t(J,null,{default:o(()=>[t(T,null,{default:o(()=>[t(V,{to:"/data?tab=relational-database"},{default:o(()=>[t(i(he)),_(" "+m(i(r)("components.layout.basicHeader.data_space")),1)]),_:1})]),_:1}),t(T,null,{default:o(()=>[t(V,{to:`/data/relational-db/${i(D)}`},{default:o(()=>[t(i(ce)),_(" "+m(S.value.name),1)]),_:1},8,["to"])]),_:1}),t(T,null,{default:o(()=>[_(m(f.value.name),1)]),_:1})]),_:1}),t(oe,{loading:x.value},{title:o(()=>[t(i(ke)),_(" "+m(f.value.name)+" ",1),t(g,{title:i(r)("workspace.databaseTableRecord.current_rows_max_rows")},{default:o(()=>[t(G,{type:"secondary"},{default:o(()=>[_(m(f.value.current_rows),1)]),_:1})]),_:1},8,["title"])]),default:o(()=>[t(ae,{activeKey:M.value,"onUpdate:activeKey":n[3]||(n[3]=c=>M.value=c),"tab-position":"left"},{default:o(()=>[t(B,{key:"sheet",tab:i(r)("workspace.databaseTableRecord.sheet")},{default:o(()=>[P("div",null,[I.value?A("",!0):(b(),j("div",Ce,[t(h,{type:"primary",loading:a.loading,onClick:a.load},{default:o(()=>[_(m(i(r)("workspace.databaseTableRecord.load_data")),1)]),_:1},8,["loading","onClick"])])),t(U,{loading:a.loading,columns:a.columns,"data-source":a.data,pagination:a.pagination,"row-selection":a.rowSelection,rowKey:"rowid",scroll:{x:970},onChange:a.handleTableChange},{title:o(()=>[t(ee,{gap:"small",justify:"space-between"},{default:o(()=>[L(P("div",null,[t(Z,{disabled:a.selectedRecords.length==0,title:i(r)("workspace.databaseTableRecord.delete_records_confirm"),onConfirm:a.deleteRecords},{default:o(()=>[t(h,{type:"text",danger:"",disabled:a.selectedRecords.length==0},{icon:o(()=>[t(i(ye))]),_:1},8,["disabled"])]),_:1},8,["disabled","title","onConfirm"]),t(g,{title:i(r)("workspace.databaseTableRecord.add_record")},{default:o(()=>[t(h,{type:"text",onClick:s.open},{icon:o(()=>[t(i(ve))]),_:1},8,["onClick"]),t(X,{open:s.visible,"onUpdate:open":n[2]||(n[2]=c=>s.visible=c),"confirm-loading":s.loading,title:i(r)("workspace.databaseTableRecord.add_record"),onOk:s.handleOk,onCancel:s.handleCancel},{default:o(()=>[t(O,{"label-col":{span:8},"wrapper-col":{span:16}},{default:o(()=>[t(E,{label:i(r)("workspace.databaseTableCreate.add_method")},{default:o(()=>[t(q,{value:s.addMethod,"onUpdate:value":n[0]||(n[0]=c=>s.addMethod=c)},{default:o(()=>[t(z,{value:"manual"},{default:o(()=>[_(m(i(r)("workspace.databaseTableCreate.add_method_manual")),1)]),_:1}),t(z,{value:"file"},{default:o(()=>[_(m(i(r)("workspace.databaseTableCreate.add_method_table_file")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),s.addMethod=="manual"?(b(),R(O,{key:0,"label-col":{span:8},"wrapper-col":{span:16}},{default:o(()=>[(b(!0),j(ue,null,_e(a.columns,c=>(b(),R(E,{label:c.title},{default:o(()=>[t(Q,{value:s.record[c.title],"onUpdate:value":v=>s.record[c.title]=v},null,8,["value","onUpdate:value"])]),_:2},1032,["label"]))),256))]),_:1})):s.addMethod=="file"?(b(),R(me,{key:1,modelValue:s.files,"onUpdate:modelValue":n[1]||(n[1]=c=>s.files=c),multiple:!1,"support-file-types":".xlsx, .xls, .csv"},null,8,["modelValue"])):A("",!0)]),_:1},8,["open","confirm-loading","title","onOk","onCancel"])]),_:1},8,["title"])],512),[[C,a.editable]]),t(Y,null,{default:o(()=>[t(g,{title:i(r)("common.edit")},{default:o(()=>[L(t(h,{type:"text",onClick:a.startEdit},{icon:o(()=>[t(i(ge))]),_:1},8,["onClick"]),[[C,!a.editable]])]),_:1},8,["title"]),t(g,{title:i(r)("common.cancel")},{default:o(()=>[L(t(h,{type:"text",onClick:a.cancelEdit},{icon:o(()=>[t(i(we))]),_:1},8,["onClick"]),[[C,a.editable]])]),_:1},8,["title"]),t(g,{title:i(r)("common.save")},{default:o(()=>[L(t(h,{type:"text",onClick:a.save},{icon:o(()=>[t(i(xe),{fill:"#28c5e5"})]),_:1},8,["onClick"]),[[C,a.editable]])]),_:1},8,["title"])]),_:1})]),_:1})]),bodyCell:o(({column:c,record:v})=>[t(te,{content:v[c.key],"onUpdate:content":le=>v[c.key]=le,editable:a.editable},null,8,["content","onUpdate:content","editable"])]),_:1},8,["loading","columns","data-source","pagination","row-selection","onChange"])])]),_:1},8,["tab"]),t(B,{key:"schema",tab:i(r)("workspace.databaseTableCreate.table_schema")},{default:o(()=>[t(U,{columns:$,"data-source":a.schema.columns,pagination:{hideOnSinglePage:!0},style:{width:"100%"}},null,8,["data-source"])]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),_:1},8,["loading"])]))}}},ze=ie(pe,[["__scopeId","data-v-e568ed2a"]]);export{ze as default};
