import{r as f,u as ue,U as ie,e as de,f as n,g as c,z as k,l as o,j as t,q as p,t as i,p as l,i as W,F as Y,x as G,k as U,a as pe,b as me,d as fe,o as ge,O as ve,m as q,Q as we,J as ne,n as ke,V as ye,w as be,G as xe}from"./index-6885f779.js";import{v as he,y as Te,K as De,z as Ce,A as Ee,B as $e,C as Ve,D as Ne,_ as Oe,a as Se,b as Ue,c as We,d as Ie,e as Pe,f as Re,g as Ae,h as Me,i as je,j as Be,k as qe,l as Fe,m as He,n as ze,o as Le,p as Ze,q as Je,r as Ye,s as Ge,t as Ke,u as Xe,w as Qe,x as et}from"./style-e3c0c3b7.js";import{_ as tt}from"./MarkdownEditor-4f57257e.js";import{_ as ot}from"./UploaderFieldUse-37ff990e.js";import{_ as at}from"./_plugin-vue_export-helper-c27b6911.js";import"./TemperatureInput-afe41978.js";import"./userDatabase-bdfe0305.js";const st={__name:"WorkflowEditor",props:{title:{type:String,required:!0},brief:{type:String,required:!0,default:""},images:{type:Array,required:!0,default:()=>[]},tags:{type:Array,required:!0},nodes:{type:Array,required:!0},edges:{type:Array,required:!0}},emits:["ok"],setup(le,{expose:_,emit:F}){const y=le,I=f(y.title),C=f(y.brief),x=f(y.images),E=f(y.tags.map(a=>a.tid)),s=f(!1),K=()=>{s.value=!0},H=a=>{F("ok",{title:I.value,brief:C.value,images:x.value,tags:E.value,workflow:N()}),s.value=!1};_({showModal:K});const $=f(!1),{t:m}=ue(),{addEdges:g,updateEdge:h,onConnect:V,toObject:N}=he();V(a=>{a.animated=!0,a.style={strokeWidth:3,stroke:"#565656"},g([a])});const T=({edge:a,connection:e})=>{h(a,e)},u=f([...y.nodes,...y.edges]),P=a=>{},O=a=>{u.value=u.value.filter(e=>e.id!==a.id),u.value=u.value.filter(e=>!(e.source&&e.source===a.id||e.target&&e.target===a.id))},R=a=>{u.value=u.value.filter(e=>!(e.source===a.edge.source&&e.target===a.edge.target&&e.sourceHandle===a.edge.sourceHandle&&e.targetHandle===a.edge.targetHandle))};ie(()=>{u.value.forEach(a=>{a.events={change:e=>P(),delete:e=>O(e)}})});let z=null;const A=a=>{z=a};let M=null;const j=a=>{a.dataTransfer.setData("nodeType",a.target.id)},L=a=>{const e=a.srcElement.id,w=S[e],v=Ne(),D=JSON.parse(JSON.stringify(B[e].props.templateData));D.description=m(`components.nodes.${w}.${e}.description`),Object.keys(D.template).forEach(b=>{D.template[b].display_name=m(`components.nodes.${w}.${e}.${b}`)});const Z=M.getBoundingClientRect(),{x:ee,y:te,zoom:J}=z.viewport.value,oe=a.clientX-Z.left,ae=a.clientY-Z.top,se={id:v,type:e,category:w,position:{x:(oe-ee)/J,y:(ae-te)/J},data:D,events:{change:b=>P(),delete:b=>O(b)}};u.value.push(se)},X=a=>{a.preventDefault(),M=a.target},Q=Object.assign({"/src/components/nodes/controlFlows/Conditional.vue":Oe,"/src/components/nodes/controlFlows/Empty.vue":Se,"/src/components/nodes/controlFlows/RandomChoice.vue":Ue,"/src/components/nodes/fileProcessing/FileLoader.vue":We,"/src/components/nodes/imageGeneration/StableDiffusion.vue":Ie,"/src/components/nodes/llms/OpenAI.vue":Pe,"/src/components/nodes/outputs/Document.vue":Re,"/src/components/nodes/outputs/Email.vue":Ae,"/src/components/nodes/outputs/Mindmap.vue":Me,"/src/components/nodes/outputs/Text.vue":je,"/src/components/nodes/textProcessing/ListRender.vue":Be,"/src/components/nodes/textProcessing/MarkdownToHtml.vue":qe,"/src/components/nodes/textProcessing/TemplateCompose.vue":Fe,"/src/components/nodes/textProcessing/TextInOut.vue":He,"/src/components/nodes/textProcessing/TextSplitters.vue":ze,"/src/components/nodes/tools/ImageSearch.vue":Le,"/src/components/nodes/tools/ProgrammingFunction.vue":Ze,"/src/components/nodes/triggers/ButtonTrigger.vue":Je,"/src/components/nodes/vectorDb/AddData.vue":Ye,"/src/components/nodes/vectorDb/DeleteData.vue":Ge,"/src/components/nodes/vectorDb/Search.vue":Ke,"/src/components/nodes/webCrawlers/BilibiliCrawler.vue":Xe,"/src/components/nodes/webCrawlers/TextCrawler.vue":Qe,"/src/components/nodes/webCrawlers/YoutubeCrawler.vue":et}),B={},d={},S={};return Object.entries(Q).forEach(([a,e])=>{const w=a.match(/\/([^/]+)\.vue$/)[1];B[w]=de(e.default);const v=a.match(/\/([^/]+)\/[^/]+\.vue$/)[1];d[v]||(d[v]=[]),d[v].push(w),S[w]=v}),(a,e)=>{const w=n("a-typography-text"),v=n("a-divider"),D=n("a-modal"),Z=n("a-button"),ee=n("a-space"),te=n("a-menu-item"),J=n("a-sub-menu"),oe=n("a-menu"),ae=n("a-layout-sider"),se=n("a-layout-content"),b=n("a-layout");return c(),k(D,{open:s.value,"onUpdate:open":e[8]||(e[8]=r=>s.value=r),width:"100%","wrap-class-name":"full-modal",onOk:H,"ok-text":l(m)("common.save")},{title:o(()=>[t(ee,null,{default:o(()=>[t(w,{style:{"font-size":"18px"},editable:{triggerType:["text","icon"]},content:I.value,"onUpdate:content":e[0]||(e[0]=r=>I.value=r)},null,8,["content"]),t(v,{type:"vertical"}),t(Te,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=r=>E.value=r)},null,8,["modelValue"]),t(v,{type:"vertical"}),t(Z,{type:"primary",onClick:e[6]||(e[6]=r=>$.value=!0)},{default:o(()=>[p(i(l(m)("components.workspace.workflowEditor.brief_editor"))+" ",1),t(D,{title:l(m)("components.workspace.workflowEditor.brief_editor"),open:$.value,onCancel:e[4]||(e[4]=r=>$.value=!1),onOk:e[5]||(e[5]=r=>$.value=!1),"ok-text":l(m)("common.save")},{default:o(()=>[t(tt,{markdown:C.value,"onUpdate:markdown":e[2]||(e[2]=r=>C.value=r)},null,8,["markdown"]),t(v,null,{default:o(()=>[p(i(l(m)("components.workspace.workflowEditor.brief_images")),1)]),_:1}),t(ot,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=r=>x.value=r),multiple:!0},null,8,["modelValue"])]),_:1},8,["title","open","ok-text"])]),_:1})]),_:1})]),default:o(()=>[t(b,{"has-sider":"",style:{height:"100%"}},{default:o(()=>[t(ae,{style:{overflow:"auto",backgroundColor:"#fff"},class:"custom-scrollbar"},{default:o(()=>[t(oe,{theme:"light",mode:"inline"},{default:o(()=>[(c(!0),W(Y,null,G(Object.keys(d),(r,ce)=>(c(),k(J,{key:`category-${ce}`},{title:o(()=>[p(i(l(m)(`components.nodes.${r}.title`)),1)]),default:o(()=>[(c(!0),W(Y,null,G(d[r],(re,_e)=>(c(),k(te,{id:re,draggable:"true",onDragstart:j,onDragend:L,key:`node-${_e}`},{default:o(()=>[U("span",null,i(l(m)(`components.nodes.${r}.${re}.title`)),1)]),_:2},1032,["id"]))),128))]),_:2},1024))),128))]),_:1})]),_:1}),t(b,null,{default:o(()=>[t(se,{style:{margin:"24px 16px 0",overflow:"initial"}},{default:o(()=>[t(l(De),{modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=r=>u.value=r),"default-edge-options":{type:"smoothstep"},"node-types":B,edgesUpdatable:!0,onEdgeUpdate:T,onPaneReady:A,onDragover:X,onEdgeDoubleClick:R,"snap-to-grid":!0,"snap-grid":[20,20]},{default:o(()=>[t(l(Ce)),t(l(Ee)),t(l($e),{variant:l(Ve).Dots},null,8,["variant"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open","ok-text"])}}};const nt={key:0,class:"space-container"},lt={style:{"margin-bottom":"10px"}},rt={style:{"margin-bottom":"10px"}},ut=["src"],ct=["src"],_t={__name:"WorkflowTemplate",setup(le){const{t:_}=ue(),F=f(!0),y=f(!1),I=pe(),C=me(),x=fe(),E=I.params.workflowTemplateId,s=f({});ge(async()=>{const g=await ve("get_template",{tid:E});if(g.status!=200){q.error(_("workspace.workflowSpace.get_workflow_failed")),C.push({name:"Workspace"});return}s.value=g.data,F.value=!1});const K=async()=>{const g=await be("create",s.value);if(g.status==200)q.success(_("workspace.workflowTemplate.add_success"));else{q.error(_("workspace.workflowTemplate.add_failed"));return}const h=s.value;x.addUserWorkflow(h),x.setUserWorkflowsTotal(x.userWorkflowsTotal+1),C.push({name:"WorkflowUse",params:{workflowId:g.data.wid}})},H=f(null),$=()=>{H.value.showModal()},m=async g=>{const{title:h,brief:V,images:N,tags:T,workflow:u}=g;(await xe("update",{tid:E,title:h,brief:V,images:N,tags:T,data:u})).status==200?(q.success(_("workspace.workflowTemplate.update_success")),s.value.title=h,s.value.brief=V,s.value.images=N,s.value.tags=T,s.value.data=u):q.error(_("workspace.workflowTemplate.update_failed"))};return(g,h)=>{const V=n("a-skeleton"),N=n("router-link"),T=n("a-breadcrumb-item"),u=n("a-breadcrumb"),P=n("a-typography-title"),O=n("a-typography-text"),R=n("a-divider"),z=n("a-tag"),A=n("a-space"),M=n("a-button"),j=n("a-col"),L=n("a-row"),X=n("a-carousel"),Q=n("a-spin"),B=we("highlight");return F.value?(c(),W("div",nt,[t(V,{active:""})])):(c(),k(Q,{key:1,spinning:y.value,class:"space-container"},{default:o(()=>[t(u,null,{default:o(()=>[t(T,null,{default:o(()=>[t(N,{to:"/workflow?tab=official-workflow-templates"},{default:o(()=>[p(i(l(_)("workspace.workflowSpaceMain.official_workflow_template")),1)]),_:1})]),_:1}),t(T,null,{default:o(()=>[p(i(s.value.title),1)]),_:1})]),_:1}),t(L,{justify:"space-around"},{default:o(()=>[t(j,{lg:12,md:12,sm:24,xs:24},{default:o(()=>[t(P,null,{default:o(()=>[p(i(`${l(_)("workspace.workflowTemplate.template")}: ${s.value.title}`),1)]),_:1}),U("div",lt,[t(A,null,{default:o(()=>[t(O,{type:"secondary"},{default:o(()=>[p(i(l(_)("common.update_time_format",{time:new Date(s.value.update_time).toLocaleString()})),1)]),_:1}),t(R,{type:"vertical"}),(c(!0),W(Y,null,G(s.value.tags,(d,S)=>(c(),k(z,{color:d.color,key:S},{default:o(()=>[p(i(d.title),1)]),_:2},1032,["color"]))),128))]),_:1})]),U("div",rt,[t(A,null,{default:o(()=>[t(O,{type:"secondary"},{default:o(()=>[p(i(l(_)("workspace.workflowTemplate.author",{author:"VectorVein"})),1)]),_:1}),t(R,{type:"vertical"}),s.value.used_count>10?(c(),k(O,{key:0,type:"secondary"},{default:o(()=>[p(i(l(_)("workspace.workflowTemplate.used_count",{count:s.value.used_count})),1)]),_:1})):ne("",!0)]),_:1})]),t(A,null,{default:o(()=>[t(M,{type:"primary",onClick:K},{default:o(()=>[p(i(l(_)("workspace.workflowTemplate.add_to_my_workflows")),1)]),_:1}),s.value.is_owner?(c(),k(M,{key:0,type:"primary",onClick:$},{default:o(()=>[p(i(l(_)("workspace.workflowTemplate.edit_template")),1)]),_:1})):ne("",!0),(c(),k(st,{ref_key:"editorModalRef",ref:H,title:s.value.title,brief:s.value.brief,images:s.value.images,tags:s.value.tags,key:s.value.wid,nodes:s.value.data.nodes,edges:s.value.data.edges,onOk:m},null,8,["title","brief","images","tags","nodes","edges"]))]),_:1})]),_:1})]),_:1}),t(R),t(L,{justify:"space-around"},{default:o(()=>[s.value.images.length>0?(c(),k(j,{key:0,lg:12,md:12,sm:24,xs:24},{default:o(()=>[t(X,{autoplay:"",arrows:"","dots-class":"slick-dots slick-thumb"},{customPaging:o(d=>[U("a",null,[U("img",{src:s.value.images[d.i]},null,8,ut)])]),default:o(()=>[(c(!0),W(Y,null,G(s.value.images,(d,S)=>(c(),W("div",{key:S},[U("img",{src:d},null,8,ct)]))),128))]),_:1})]),_:1})):ne("",!0),t(j,{lg:12,md:12,sm:24,xs:24},{default:o(()=>[ke(t(l(ye),{source:s.value.brief,class:"custom-scrollbar markdown-body custom-hljs"},null,8,["source"]),[[B]])]),_:1})]),_:1})]),_:1},8,["spinning"]))}}},wt=at(_t,[["__scopeId","data-v-15201269"]]);export{wt as default};
