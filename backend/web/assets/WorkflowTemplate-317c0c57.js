import{r as v,j as ue,f as ie,R as de,l as n,p as _,q as k,s as t,c as o,y as p,z as i,u as l,v as S,F as Z,x as X,B as P,I as pe,J as me,L as ve,N as fe,a3 as ge,P as F,m as we,D as ne,G as ke,V as ye,O as be,X as xe}from"./index-220f57da.js";import{v as he,I as Te,J as De,K as Ce,L as Ee,M as $e,N as Ne,O as Oe,_ as Ie,a as Ve,b as Pe,c as Se,d as We,e as Me,f as Ue,g as Re,h as Ae,i as je,j as Be,k as Fe,l as qe,m as Le,n as He,o as Je,p as ze,q as Ge,r as Ze,s as Xe,t as Ye,w as Ke,x as Qe,y as eo,z as oo,A as to,B as so,C as ao,D as no,E as lo,F as ro,G as uo}from"./style-db179c28.js";import{_ as _o}from"./MarkdownEditor-8239a402.js";import{_ as co}from"./UploaderFieldUse-85e1593f.js";import{_ as io}from"./_plugin-vue_export-helper-c27b6911.js";import"./TemperatureInput-4bf114a7.js";import"./AddOne-4e0b3b3d.js";import"./userDatabase-aac0bca9.js";import"./QuestionPopover-1dbf7ded.js";import"./stringify-ec884b6d.js";const po={__name:"WorkflowEditor",props:{title:{type:String,required:!0},brief:{type:String,required:!0,default:""},images:{type:Array,required:!0,default:()=>[]},tags:{type:Array,required:!0},nodes:{type:Array,required:!0},edges:{type:Array,required:!0}},emits:["ok"],setup(le,{expose:c,emit:q}){const y=le,W=v(y.title),C=v(y.brief),x=v(y.images),E=v(y.tags.map(s=>s.tid)),a=v(!1),Y=()=>{a.value=!0},L=s=>{q("ok",{title:W.value,brief:C.value,images:x.value,tags:E.value,workflow:O()}),a.value=!1};c({showModal:Y});const $=v(!1),{t:m}=ue(),{addEdges:f,updateEdge:h,onConnect:N,toObject:O}=he();N(s=>{s.animated=!0,s.style={strokeWidth:3,stroke:"#565656"},f([s])});const T=({edge:s,connection:e})=>{h(s,e)},u=v([...y.nodes,...y.edges]),M=s=>{},I=s=>{u.value=u.value.filter(e=>e.id!==s.id),u.value=u.value.filter(e=>!(e.source&&e.source===s.id||e.target&&e.target===s.id))},U=s=>{u.value=u.value.filter(e=>!(e.source===s.edge.source&&e.target===s.edge.target&&e.sourceHandle===s.edge.sourceHandle&&e.targetHandle===s.edge.targetHandle))};ie(()=>{u.value.forEach(s=>{s.events={change:e=>M(),delete:e=>I(e)}})});let H=null;const R=s=>{H=s};let A=null;const j=s=>{s.dataTransfer.setData("nodeType",s.target.id)},J=s=>{const e=s.srcElement.id,w=V[e],g=Oe(),D=JSON.parse(JSON.stringify(B[e].props.templateData));D.description=m(`components.nodes.${w}.${e}.description`),Object.keys(D.template).forEach(b=>{D.template[b].display_name=m(`components.nodes.${w}.${e}.${b}`)});const z=A.getBoundingClientRect(),{x:ee,y:oe,zoom:G}=H.viewport.value,te=s.clientX-z.left,se=s.clientY-z.top,ae={id:g,type:e,category:w,position:{x:(te-ee)/G,y:(se-oe)/G},data:D,events:{change:b=>M(),delete:b=>I(b)}};u.value.push(ae)},K=s=>{s.preventDefault(),A=s.target},Q=Object.assign({"/src/components/nodes/assistedNodes/CommentNode.vue":Ie,"/src/components/nodes/controlFlows/Conditional.vue":Ve,"/src/components/nodes/controlFlows/Empty.vue":Pe,"/src/components/nodes/controlFlows/JsonProcess.vue":Se,"/src/components/nodes/controlFlows/RandomChoice.vue":We,"/src/components/nodes/fileProcessing/FileLoader.vue":Me,"/src/components/nodes/imageGeneration/StableDiffusion.vue":Ue,"/src/components/nodes/llms/ChatGLM.vue":Re,"/src/components/nodes/llms/OpenAI.vue":Ae,"/src/components/nodes/outputs/Document.vue":je,"/src/components/nodes/outputs/Echarts.vue":Be,"/src/components/nodes/outputs/Email.vue":Fe,"/src/components/nodes/outputs/Mermaid.vue":qe,"/src/components/nodes/outputs/Mindmap.vue":Le,"/src/components/nodes/outputs/Text.vue":He,"/src/components/nodes/outputs/WorkflowInvokeOutput.vue":Je,"/src/components/nodes/textProcessing/ListRender.vue":ze,"/src/components/nodes/textProcessing/MarkdownToHtml.vue":Ge,"/src/components/nodes/textProcessing/TemplateCompose.vue":Ze,"/src/components/nodes/textProcessing/TextInOut.vue":Xe,"/src/components/nodes/textProcessing/TextSplitters.vue":Ye,"/src/components/nodes/textProcessing/TextTruncation.vue":Ke,"/src/components/nodes/tools/ImageSearch.vue":Qe,"/src/components/nodes/tools/ProgrammingFunction.vue":eo,"/src/components/nodes/tools/WorkflowInvoke.vue":oo,"/src/components/nodes/triggers/ButtonTrigger.vue":to,"/src/components/nodes/vectorDb/AddData.vue":so,"/src/components/nodes/vectorDb/DeleteData.vue":ao,"/src/components/nodes/vectorDb/Search.vue":no,"/src/components/nodes/webCrawlers/BilibiliCrawler.vue":lo,"/src/components/nodes/webCrawlers/TextCrawler.vue":ro,"/src/components/nodes/webCrawlers/YoutubeCrawler.vue":uo}),B={},d={},V={};return Object.entries(Q).forEach(([s,e])=>{const w=s.match(/\/([^/]+)\.vue$/)[1];B[w]=de(e.default);const g=s.match(/\/([^/]+)\/[^/]+\.vue$/)[1];d[g]||(d[g]=[]),d[g].push(w),V[w]=g}),(s,e)=>{const w=n("a-typography-text"),g=n("a-divider"),D=n("a-modal"),z=n("a-button"),ee=n("a-space"),oe=n("a-menu-item"),G=n("a-sub-menu"),te=n("a-menu"),se=n("a-layout-sider"),ae=n("a-layout-content"),b=n("a-layout");return _(),k(D,{open:a.value,"onUpdate:open":e[8]||(e[8]=r=>a.value=r),width:"100%","wrap-class-name":"full-modal",onOk:L,"ok-text":l(m)("common.save")},{title:t(()=>[o(ee,null,{default:t(()=>[o(w,{style:{"font-size":"18px"},editable:{triggerType:["text","icon"]},content:W.value,"onUpdate:content":e[0]||(e[0]=r=>W.value=r)},null,8,["content"]),o(g,{type:"vertical"}),o(Te,{modelValue:E.value,"onUpdate:modelValue":e[1]||(e[1]=r=>E.value=r)},null,8,["modelValue"]),o(g,{type:"vertical"}),o(z,{type:"primary",onClick:e[6]||(e[6]=r=>$.value=!0)},{default:t(()=>[p(i(l(m)("components.workspace.workflowEditor.brief_editor"))+" ",1),o(D,{title:l(m)("components.workspace.workflowEditor.brief_editor"),open:$.value,onCancel:e[4]||(e[4]=r=>$.value=!1),onOk:e[5]||(e[5]=r=>$.value=!1),"ok-text":l(m)("common.save")},{default:t(()=>[o(_o,{markdown:C.value,"onUpdate:markdown":e[2]||(e[2]=r=>C.value=r)},null,8,["markdown"]),o(g,null,{default:t(()=>[p(i(l(m)("components.workspace.workflowEditor.brief_images")),1)]),_:1}),o(co,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=r=>x.value=r),multiple:!0},null,8,["modelValue"])]),_:1},8,["title","open","ok-text"])]),_:1})]),_:1})]),default:t(()=>[o(b,{"has-sider":"",style:{height:"100%"}},{default:t(()=>[o(se,{style:{overflow:"auto",backgroundColor:"#fff"},class:"custom-scrollbar"},{default:t(()=>[o(te,{theme:"light",mode:"inline"},{default:t(()=>[(_(!0),S(Z,null,X(Object.keys(d),(r,_e)=>(_(),k(G,{key:`category-${_e}`},{title:t(()=>[p(i(l(m)(`components.nodes.${r}.title`)),1)]),default:t(()=>[(_(!0),S(Z,null,X(d[r],(re,ce)=>(_(),k(oe,{id:re,draggable:"true",onDragstart:j,onDragend:J,key:`node-${ce}`},{default:t(()=>[P("span",null,i(l(m)(`components.nodes.${r}.${re}.title`)),1)]),_:2},1032,["id"]))),128))]),_:2},1024))),128))]),_:1})]),_:1}),o(b,null,{default:t(()=>[o(ae,{style:{margin:"24px 16px 0",overflow:"initial"}},{default:t(()=>[o(l(De),{modelValue:u.value,"onUpdate:modelValue":e[7]||(e[7]=r=>u.value=r),"default-edge-options":{type:"smoothstep"},"node-types":B,edgesUpdatable:!0,onEdgeUpdate:T,onPaneReady:R,onDragover:K,onEdgeDoubleClick:U,"snap-to-grid":!0,"snap-grid":[20,20]},{default:t(()=>[o(l(Ce)),o(l(Ee)),o(l($e),{variant:l(Ne).Dots},null,8,["variant"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["open","ok-text"])}}};const mo={key:0,class:"space-container"},vo={style:{"margin-bottom":"10px"}},fo={style:{"margin-bottom":"10px"}},go=["src"],wo=["src"],ko={__name:"WorkflowTemplate",setup(le){const{t:c}=ue(),q=v(!0),y=v(!1),W=pe(),C=me(),x=ve(),E=W.params.workflowTemplateId,a=v({});fe(async()=>{const f=await ge("get_template",{tid:E});if(f.status!=200){F.error(c("workspace.workflowSpace.get_workflow_failed")),C.push({name:"Workspace"});return}a.value=f.data,q.value=!1});const Y=async()=>{const f=await be("create",a.value);if(f.status==200)F.success(c("workspace.workflowTemplate.add_success"));else{F.error(c("workspace.workflowTemplate.add_failed"));return}const h=a.value;x.addUserWorkflow(h),x.setUserWorkflowsTotal(x.userWorkflowsTotal+1),C.push({name:"WorkflowUse",params:{workflowId:f.data.wid}})},L=v(null),$=()=>{L.value.showModal()},m=async f=>{const{title:h,brief:N,images:O,tags:T,workflow:u}=f;(await xe("update",{tid:E,title:h,brief:N,images:O,tags:T,data:u})).status==200?(F.success(c("workspace.workflowTemplate.update_success")),a.value.title=h,a.value.brief=N,a.value.images=O,a.value.tags=T,a.value.data=u):F.error(c("workspace.workflowTemplate.update_failed"))};return(f,h)=>{const N=n("a-skeleton"),O=n("router-link"),T=n("a-breadcrumb-item"),u=n("a-breadcrumb"),M=n("a-typography-title"),I=n("a-typography-text"),U=n("a-divider"),H=n("a-tag"),R=n("a-space"),A=n("a-button"),j=n("a-col"),J=n("a-row"),K=n("a-carousel"),Q=n("a-spin"),B=we("highlight");return q.value?(_(),S("div",mo,[o(N,{active:""})])):(_(),k(Q,{key:1,spinning:y.value,class:"space-container"},{default:t(()=>[o(u,null,{default:t(()=>[o(T,null,{default:t(()=>[o(O,{to:"/workflow?tab=official-workflow-templates"},{default:t(()=>[p(i(l(c)("workspace.workflowSpaceMain.official_workflow_template")),1)]),_:1})]),_:1}),o(T,null,{default:t(()=>[p(i(a.value.title),1)]),_:1})]),_:1}),o(J,{justify:"space-around"},{default:t(()=>[o(j,{lg:12,md:12,sm:24,xs:24},{default:t(()=>[o(M,null,{default:t(()=>[p(i(`${l(c)("workspace.workflowTemplate.template")}: ${a.value.title}`),1)]),_:1}),P("div",vo,[o(R,null,{default:t(()=>[o(I,{type:"secondary"},{default:t(()=>[p(i(l(c)("common.update_time_format",{time:new Date(a.value.update_time).toLocaleString()})),1)]),_:1}),o(U,{type:"vertical"}),(_(!0),S(Z,null,X(a.value.tags,(d,V)=>(_(),k(H,{color:d.color,key:V},{default:t(()=>[p(i(d.title),1)]),_:2},1032,["color"]))),128))]),_:1})]),P("div",fo,[o(R,null,{default:t(()=>[o(I,{type:"secondary"},{default:t(()=>[p(i(l(c)("workspace.workflowTemplate.author",{author:"VectorVein"})),1)]),_:1}),o(U,{type:"vertical"}),a.value.used_count>10?(_(),k(I,{key:0,type:"secondary"},{default:t(()=>[p(i(l(c)("workspace.workflowTemplate.used_count",{count:a.value.used_count})),1)]),_:1})):ne("",!0)]),_:1})]),o(R,null,{default:t(()=>[o(A,{type:"primary",onClick:Y},{default:t(()=>[p(i(l(c)("workspace.workflowTemplate.add_to_my_workflows")),1)]),_:1}),a.value.is_owner?(_(),k(A,{key:0,type:"primary",onClick:$},{default:t(()=>[p(i(l(c)("workspace.workflowTemplate.edit_template")),1)]),_:1})):ne("",!0),(_(),k(po,{ref_key:"editorModalRef",ref:L,title:a.value.title,brief:a.value.brief,images:a.value.images,tags:a.value.tags,key:a.value.wid,nodes:a.value.data.nodes,edges:a.value.data.edges,onOk:m},null,8,["title","brief","images","tags","nodes","edges"]))]),_:1})]),_:1})]),_:1}),o(U),o(J,{justify:"space-around"},{default:t(()=>[a.value.images.length>0?(_(),k(j,{key:0,lg:12,md:12,sm:24,xs:24},{default:t(()=>[o(K,{autoplay:"",arrows:"","dots-class":"slick-dots slick-thumb"},{customPaging:t(d=>[P("a",null,[P("img",{src:a.value.images[d.i]},null,8,go)])]),default:t(()=>[(_(!0),S(Z,null,X(a.value.images,(d,V)=>(_(),S("div",{key:V},[P("img",{src:d},null,8,wo)]))),128))]),_:1})]),_:1})):ne("",!0),o(j,{lg:12,md:12,sm:24,xs:24},{default:t(()=>[ke(o(l(ye),{source:a.value.brief,class:"custom-scrollbar markdown-body custom-hljs"},null,8,["source"]),[[B]])]),_:1})]),_:1})]),_:1},8,["spinning"]))}}},Oo=io(ko,[["__scopeId","data-v-15201269"]]);export{Oo as default};
