import{_ as ce,W as ie,s as x,x as de,r as M,a as ue,a1 as O,h as D,c as e,j as t,a7 as _e,M as o,a9 as pe,f as b,B as a,T as u,D as _,aN as me,C as be,aO as fe,F as P,K as v,E as y,$ as ge,aa as ve}from"./index-26IlJ65o.js";import{b as T,d as ke}from"./database-DdkAp0db.js";import{F as we}from"./FileCabinet-DOoa5TN4.js";import{E as ye}from"./Edit-CzOA7Xnc.js";import{C as he}from"./Check-Cd7fhjuZ.js";import{C as je}from"./Close-CmNKIQuR.js";const xe={key:0,class:"loading-container"},Oe={key:1,class:"dataspace-container"},De={__name:"VectorDatabaseObjectDetail",setup(Ce){const{t:n}=ie(),h=x(!0),S=_e(),U=S.params.databaseId,L=S.params.objectId,C=x({}),s=x({}),A=async()=>{const l=await ke("get",{vid:U});l.status==200?C.value=l.data:O.error(l.msg)},q=async()=>{const l=await T("get",{oid:L});l.status==200?s.value=l.data:O.error(l.msg)};de(async()=>{h.value=!0,await Promise.all([A(),q()]),p.data=s.value.raw_data.segments,h.value=!1});const V=x("segments"),p=M({columns:[{title:"#",key:"index",dataIndex:"index",width:"50px"},{title:n("workspace.databaseObjectDetail.segment_text"),key:"text",dataIndex:"text",ellipsis:!0},{title:n("workspace.databaseObjectDetail.segment_word_counts"),key:"word_counts",dataIndex:"word_counts",width:"100px"}],data:[],loading:!1,current:1,pageSize:10,total:0,pagination:ue(()=>({total:p.total,current:p.current,pageSize:p.pageSize})),handleTableChange:(l,i,j)=>{p.load({page_size:l.pageSize,page:l.current,sort_field:j.field,sort_order:j.order})},hoverRowOid:null,customRow:l=>({style:{cursor:"pointer"},onClick:async i=>{(i.target.classList.contains("ant-table-cell")||i.target.classList.contains("object-title"))&&(f.segmentIndex=l.index,f.text=l.text,f.keywords=l.keywords,f.open=!0)},onMouseenter:i=>{p.hoverRowOid=l.vid},onMouseleave:i=>{p.hoverRowOid=null}})}),f=M({open:!1,segmentIndex:0,text:"",keywords:[]}),d=M({open:!1,form:{title:s.value.title},show:()=>{d.open=!0,d.form.title=s.value.title},ok:async()=>{const l=await T("update",{oid:s.value.oid,...d.form});l.status==200?(O.success(n("common.save_success")),s.value.title=d.form.title,d.open=!1):O.error(l.msg)}});return(l,i)=>{const j=o("a-spin"),z=o("router-link"),I=o("a-breadcrumb-item"),H=o("a-breadcrumb"),B=o("a-col"),W=o("a-button"),G=o("a-tooltip"),J=o("a-input"),Q=o("a-form-item"),X=o("a-form"),$=o("a-modal"),Y=o("a-flex"),E=o("a-typography-link"),Z=o("a-popconfirm"),ee=o("a-table"),R=o("a-tab-pane"),te=o("a-divider"),k=o("a-descriptions-item"),ae=o("a-descriptions"),oe=o("a-tabs"),se=o("a-typography-paragraph"),ne=o("a-card"),le=o("a-row"),re=pe("highlight");return h.value?(b(),D("div",xe,[e(j)])):(b(),D("div",Oe,[e(le,{align:"center",gutter:[16,16]},{default:t(()=>[e(B,{xl:16,lg:18,md:20,sm:22,xs:24},{default:t(()=>[e(H,null,{default:t(()=>[e(I,null,{default:t(()=>[e(z,{to:"/data"},{default:t(()=>[e(a(we)),u(" "+_(a(n)("components.layout.basicHeader.data_space")),1)]),_:1})]),_:1}),e(I,null,{default:t(()=>[e(z,{to:`/data/vector-db/${C.value.vid}`},{default:t(()=>[e(a(me)),u(" "+_(C.value.name),1)]),_:1},8,["to"])]),_:1}),e(I,null,{default:t(()=>[u(_(s.value.title),1)]),_:1})]),_:1})]),_:1}),e(B,{xl:16,lg:18,md:20,sm:22,xs:24},{default:t(()=>[e(ne,{loading:h.value},{title:t(()=>[e(Y,{justify:"space-between",align:"center"},{default:t(()=>[be("div",null,[e(a(fe)),u(" "+_(s.value.title),1)]),e(G,{title:a(n)("workspace.databaseObjectDetail.modify_object_info")},{default:t(()=>[e(W,{type:"text",size:"large",onClick:d.show},{icon:t(()=>[e(a(ye))]),_:1},8,["onClick"])]),_:1},8,["title"]),e($,{title:a(n)("workspace.databaseObjectDetail.modify_object_info"),onOk:d.ok,"confirm-loading":d.createLoading,open:d.open,"onUpdate:open":i[1]||(i[1]=r=>d.open=r)},{default:t(()=>[e(X,{model:d.form,layout:"vertical"},{default:t(()=>[e(Q,{label:a(n)("workspace.databaseObjectDetail.object_title"),name:"title",rules:[{required:!0}]},{default:t(()=>[e(J,{value:d.form.title,"onUpdate:value":i[0]||(i[0]=r=>d.form.title=r)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["title","onOk","confirm-loading","open"])]),_:1})]),default:t(()=>[e(oe,{activeKey:V.value,"onUpdate:activeKey":i[2]||(i[2]=r=>V.value=r),"tab-position":"left"},{default:t(()=>[e(R,{key:"segments",tab:a(n)("workspace.databaseObjectDetail.segments")},{default:t(()=>[e(ee,{customRow:p.customRow,columns:p.columns,"data-source":p.data,pagination:p.pagination},{bodyCell:t(({column:r,record:g})=>[r.key==="keywords"?(b(),D(P,{key:0},[u(_(g.keywords.join(", ")),1)],64)):r.key==="action"?(b(),D(P,{key:1},[g.status!="PR"?(b(),v(Z,{key:0,placement:"leftTop",title:a(n)("workspace.databaseDetail.delete_confirm"),onConfirm:w=>l.deleteObject(g.oid)},{default:t(()=>[e(E,{type:"danger"},{default:t(()=>[u(_(a(n)("workspace.databaseDetail.delete")),1)]),_:1})]),_:2},1032,["title","onConfirm"])):y("",!0)],64)):y("",!0)]),_:1},8,["customRow","columns","data-source","pagination"])]),_:1},8,["tab"]),e(R,{key:"full-document",tab:a(n)("workspace.databaseObjectDetail.full_document")},{default:t(()=>{var r,g,w;return[((r=s.value.source_url)==null?void 0:r.length)>0?(b(),v(E,{key:0,href:s.value.source_url,target:"_blank"},{default:t(()=>[u(_(a(n)("workspace.databaseObjectDetail.source_url")),1)]),_:1},8,["href"])):y("",!0),((g=s.value.source_url)==null?void 0:g.length)>0?(b(),v(te,{key:1})):y("",!0),ge(e(a(ve),{source:((w=s.value.raw_data)==null?void 0:w.text)||"",class:"custom-scrollbar markdown-body custom-hljs"},null,8,["source"]),[[re]])]}),_:1},8,["tab"]),e(R,{key:"params_info",tab:a(n)("workspace.databaseObjectDetail.params_info")},{default:t(()=>[e(ae,{bordered:""},{default:t(()=>{var r,g,w,K;return[e(k,{label:a(n)("workspace.databaseObjectCreate.split_method")},{default:t(()=>{var c,m,N,F;return[u(_((m=(c=s.value.info)==null?void 0:c.process_rules)!=null&&m.split_method?a(n)(`workspace.databaseObjectCreate.split_method_${(F=(N=s.value.info)==null?void 0:N.process_rules)==null?void 0:F.split_method}`):""),1)]}),_:1},8,["label"]),((g=(r=s.value.info)==null?void 0:r.process_rules)==null?void 0:g.split_method)!="delimeter"?(b(),v(k,{key:0,label:a(n)("workspace.databaseObjectCreate.chunk_length")},{default:t(()=>{var c,m;return[u(_((m=(c=s.value.info)==null?void 0:c.process_rules)==null?void 0:m.chunk_length),1)]}),_:1},8,["label"])):y("",!0),((K=(w=s.value.info)==null?void 0:w.process_rules)==null?void 0:K.split_method)=="delimeter"?(b(),v(k,{key:1,label:a(n)("workspace.databaseObjectCreate.delimiter")},{default:t(()=>{var c,m;return[u(_((m=(c=s.value.info)==null?void 0:c.process_rules)==null?void 0:m.delimiter),1)]}),_:1},8,["label"])):y("",!0),e(k,{label:a(n)("workspace.databaseObjectCreate.remove_url_and_email")},{default:t(()=>{var c,m;return[(m=(c=s.value.info)==null?void 0:c.process_rules)!=null&&m.remove_url_and_email?(b(),v(a(he),{key:0})):(b(),v(a(je),{key:1}))]}),_:1},8,["label"]),e(k,{label:a(n)("workspace.databaseObjectDetail.paragraph_counts")},{default:t(()=>{var c;return[u(_((c=s.value.info)==null?void 0:c.paragraph_counts),1)]}),_:1},8,["label"]),e(k,{label:a(n)("workspace.databaseObjectDetail.word_counts")},{default:t(()=>{var c;return[u(_((c=s.value.info)==null?void 0:c.word_counts),1)]}),_:1},8,["label"])]}),_:1})]),_:1},8,["tab"])]),_:1},8,["activeKey"]),e($,{open:f.open,"onUpdate:open":i[3]||(i[3]=r=>f.open=r),title:`# ${f.segmentIndex}`,onCancel:i[4]||(i[4]=r=>f.open=!1),footer:null},{default:t(()=>[e(se,{content:f.text},null,8,["content"])]),_:1},8,["open","title"])]),_:1},8,["loading"])]),_:1})]),_:1})]))}}},Be=ce(De,[["__scopeId","data-v-4e488387"]]);export{Be as default};
