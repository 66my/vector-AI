import{c as t,U as Ne,ab as Ee,a2 as ke,r as p,aa as Ae,a8 as Oe,a9 as He,D as ze,a4 as O,X as y,a5 as Q,m as Y,aq as Be,b as qe,P as u,an as Pe,o as s,e as f,K as w,x as o,R as g,H as m,u as r,G as V,y as F,F as R,V as D,ao as ee,I as x,W as te,a6 as Je,ar as Ge,as as _e}from"./index-0413f821.js";import{u as Ze}from"./userDatabase-54a04241.js";import{E as Ke,_ as Xe,a as Qe,b as Ye,c as et,d as tt,e as at,f as ot}from"./TextOutput-c77a4ce7.js";import{_ as lt}from"./UploaderFieldUse-cac609a6.js";import{_ as st}from"./WorkflowRunRecordsDrawer-2508dbe3.js";import{d as nt}from"./database-7611c959.js";import{_ as rt}from"./_plugin-vue_export-helper-c27b6911.js";import{I as ae}from"./index-51945b37.js";const ut=ae("full-screen-one",!1,function(e){return t("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[t("path",{d:"M6 6L16 15.8995",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M6 41.8995L16 32",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M42.0001 41.8995L32.1006 32",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M41.8995 6L32 15.8995",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M33 6H42V15",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M42 33V42H33",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M15 42H6V33",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M6 15V6H15",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null)])}),it=ae("lightning",!0,function(e){return t("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[t("path",{d:"M19 4H37L26 18H41L17 44L22 25H8L19 4Z",fill:e.colors[1],stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linejoin":e.strokeLinejoin},null)])}),ct=ae("off-screen-one",!1,function(e){return t("svg",{width:e.size,height:e.size,viewBox:"0 0 48 48",fill:"none"},[t("path",{d:"M6 6L16 15.8995",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M6 41.8995L16 32",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M42.0001 41.8995L32.1006 32",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M41.8995 6L32 15.8995",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M32 7V16H41",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M16 7V16H7",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M16 41V32H7",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null),t("path",{d:"M32 41V32H40.8995",stroke:e.colors[0],"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin},null)])});const dt={key:0,class:"space-container"},kt=["src"],_t=["src"],pt={key:0},ft={key:0},wt={key:1},vt={key:2},mt={key:3},ht={key:4},gt={key:5},yt={key:6},St={key:0},Lt={__name:"WorkflowSpaceUse",setup(e){const{t:n}=Ne(),pe=Ee(),{language:fe,setting:we}=ke(pe),oe=Ze(),{userDatabases:ve}=ke(oe),le=p(!0),me=p(!1),se=Ae(),H=Oe(),z=He(),B=H.params.workflowId,q=p(!1),he=p(window.innerWidth<=768?"90vw":"60vw"),S=p(!1),M=p([]),T=p([]),N=p([]);ze(async()=>{const k=O("get",{wid:B}),i=nt("list",{}),c=await k,l=await i;if(l.status==200&&oe.setUserDatabases(l.data),c.status!=200){y.error(n("workspace.workflowSpace.get_workflow_failed")),z.push({name:"WorkflowSpaceMain"});return}d.value=c.data,d.value.data.nodes.forEach($=>{$.category=="vectorDb"&&($.data.template.database.options=ve.value.filter(W=>W.status=="VALID").map(W=>({value:W.vid,label:W.name})))});const v=Q(d.value),h=Y(v);if(M.value=h.inputFields,T.value=h.outputNodes,N.value=h.triggerNodes,P.value=JSON.parse(JSON.stringify(d.value)),H.query.rid){const W=await Be("get",{rid:H.query.rid});try{ue(W.data)}catch{y.error(n("workspace.workflowSpace.get_workflow_record_failed"))}}le.value=!1});const d=p({}),P=p({}),b=p(!1),J=p(null),E=p(null),ge=async()=>{E.value=null,A.value=!1;let k=!0;try{M.value.forEach(l=>{let v=!0;l.field_type!="checkbox"&&l.show&&l.required&&((l.field_type=="file"&&l.value.length==0||l.field_type=="number"&&typeof l.value!="number"||!l.value&&!l.value===0)&&(v=!1),v||(y.error(n("workspace.workflowSpace.field_is_empty",{field:l.display_name})),k=!1))})}catch{k=!1}if(!k)return;let i=JSON.parse(JSON.stringify(P.value));i.data.nodes.forEach(l=>{l.data.has_inputs&&Ge(l)&&!["triggers"].includes(l.category)&&Object.keys(l.data.template).forEach(v=>{l.data.template[v].show&&(l.data.template[v].value=d.value.data.nodes.find(h=>h.id==l.id).data.template[v].value)})}),b.value=!0,i.data.setting=we.value.data;const c=await O("run",i);c.status==200?(y.success(n("workspace.workflowSpace.submit_workflow_success")),E.value=c.data.rid,J.value=setInterval(async()=>{const l=await O("check_status",{rid:E.value});if(l.status==200){y.success(n("workspace.workflowSpace.run_workflow_success")),clearInterval(J.value),b.value=!1,d.value=l.data;const v=Q(d.value),h=Y(v);M.value=h.inputFields,T.value=h.outputNodes,N.value=h.triggerNodes}else l.status==500&&(b.value=!1,U.value="FAILED",y.error(n("workspace.workflowSpace.run_workflow_failed")),clearInterval(J.value),re(l.data.error_task),A.value=!0)},1e3)):(y.error(n("workspace.workflowSpace.submit_workflow_failed")),b.value=!1)},ye=async()=>{b.value=!0,(await _e("update",{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,...d.value})).status==200?y.success(n("workspace.workflowSpace.update_schedule_success")):y.error(n("workspace.workflowSpace.update_schedule_failed")),b.value=!1},ne=p(!1),Se=async()=>{ne.value=!0,(await _e("delete",{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,...d.value})).status==200?y.success(n("workspace.workflowSpace.delete_schedule_success")):y.error(n("workspace.workflowSpace.delete_schedule_failed")),ne.value=!1},Le=async()=>{(await O("delete",{wid:d.value.wid})).status==200?(y.success(n("workspace.workflowSpace.delete_success")),se.deleteUserWorkflow(d.value.wid),se.deleteUserWorkflow(d.value.wid,!0),z.push({name:"WorkflowSpaceMain"})):y.error(n("workspace.workflowSpace.delete_failed"))},be=()=>{z.push({name:"WorkflowEditor",params:{workflowId:B}})},A=p(!1),U=p(""),G=p(""),je=qe(()=>U.value=="FINISHED"?"success":U.value=="FAILED"?"error":"info"),re=k=>{let[i,c]=(k||".").split(".");i=i.split("_").map((l,v)=>v===0?l.charAt(0).toLowerCase()+l.slice(1):l.charAt(0).toUpperCase()+l.slice(1)).join(""),i=="output"&&(i="outputs"),c=c.split("_").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(""),c=="OpenAi"?c="OpenAI":c=="ChatGlm"?c="ChatGLM":c=="SearchData"&&i=="vectorDb"&&(c="Search"),G.value=`${i}.${c}`},ue=k=>{E.value=k.rid,U.value=k.status,d.value.data={...k.data,ui:P.value.data.ui||{}},re(k.data.error_task);const i=Q(d.value),c=Y(i);M.value=c.inputFields,T.value=c.outputNodes,N.value=c.triggerNodes,A.value=!0},We=k=>{window.pywebview.api.open_local_file(k)};return(k,i)=>{const c=u("a-skeleton"),l=u("a-typography-title"),v=u("a-typography-text"),h=u("a-divider"),$=u("a-carousel"),W=u("a-modal"),Z=u("a-typography-link"),xe=u("a-tag"),K=u("a-space"),L=u("a-col"),C=u("a-button"),ie=u("a-popconfirm"),I=u("a-row"),Ue=u("a-alert"),Ie=u("a-select"),Ve=u("a-textarea"),De=u("a-input"),Me=u("a-input-number"),$e=u("a-checkbox"),Ce=u("a-form-item"),Fe=u("a-form"),Re=u("cron-ant"),Te=u("a-card"),ce=u("a-tooltip"),de=u("a-spin"),X=Pe("highlight");return le.value?(s(),f("div",dt,[t(c,{active:""})])):(s(),w(de,{key:1,spinning:me.value,class:"space-container"},{default:o(()=>[t(I,{justify:"space-between",align:"middle"},{default:o(()=>[t(L,null,{default:o(()=>[t(l,null,{default:o(()=>[g(m(d.value.title),1)]),_:1}),t(K,null,{default:o(()=>[t(v,{type:"secondary"},{default:o(()=>[g(m(r(n)("workspace.workflowSpace.update_time",{time:new Date(d.value.update_time).toLocaleString()})),1)]),_:1}),t(h,{type:"vertical"}),t(Z,{onClick:i[1]||(i[1]=a=>q.value=!0)},{default:o(()=>[g(m(r(n)("workspace.workflowSpace.brief"))+" ",1),t(W,{open:q.value,title:r(n)("workspace.workflowSpace.brief"),width:he.value,footer:null,class:"introduction-modal",onCancel:i[0]||(i[0]=a=>q.value=!1)},{default:o(()=>[t($,{autoplay:"",arrows:"","dots-class":"slick-dots slick-thumb"},{customPaging:o(a=>[V("a",null,[V("img",{src:d.value.images[a.i]},null,8,kt)])]),default:o(()=>[(s(!0),f(R,null,F(d.value.images,(a,j)=>(s(),f("div",{key:j},[V("img",{src:a},null,8,_t)]))),128))]),_:1}),D(t(r(ee),{source:d.value.brief,class:"custom-scrollbar markdown-body custom-hljs"},null,8,["source"]),[[X]])]),_:1},8,["open","title","width"])]),_:1}),t(h,{type:"vertical"}),(s(!0),f(R,null,F(d.value.tags,(a,j)=>(s(),w(xe,{color:a.color,key:j},{default:o(()=>[g(m(a.title),1)]),_:2},1032,["color"]))),128))]),_:1})]),_:1}),t(L,null,{default:o(()=>[t(K,null,{default:o(()=>[t(st,{workflowId:r(B),onOpenRecord:ue},null,8,["workflowId"]),t(C,{onClick:be},{default:o(()=>[g(m(r(n)("workspace.workflowSpace.edit")),1)]),_:1}),t(ie,{placement:"leftTop",title:r(n)("workspace.workflowSpace.delete_confirm"),onConfirm:Le},{default:o(()=>[t(C,{type:"primary",danger:""},{default:o(()=>[g(m(r(n)("workspace.workflowSpace.delete")),1)]),_:1})]),_:1},8,["title"])]),_:1})]),_:1})]),_:1}),t(h),t(I,{gutter:[16,16]},{default:o(()=>[A.value?(s(),w(L,{key:0,span:24},{default:o(()=>[t(Ue,{type:je.value,"show-icon":""},{message:o(()=>[V("span",null,m(r(n)("workspace.workflowSpace.record_status",{status:r(n)(`components.workspace.workflowRunRecordsDrawer.status_${U.value.toLowerCase()}`)})),1),t(h,{type:"vertical"}),U.value=="FAILED"&&G.value!="."?(s(),f("span",pt,m(r(n)("workspace.workflowSpace.record_error_task",{task:r(n)("components.nodes."+G.value+".title")})),1)):x("",!0)]),_:1},8,["type"])]),_:1})):x("",!0),D(t(L,{xxl:6,xl:8,lg:10,md:24},{default:o(()=>[t(I,{gutter:[16,16]},{default:o(()=>[t(l,{level:3},{default:o(()=>[t(r(Ke),{fill:"#28c5e5"}),g(" "+m(r(n)("workspace.workflowSpace.inputs")),1)]),_:1}),t(L,{span:24},{default:o(()=>[t(Fe,{layout:"vertical"},{default:o(()=>[(s(!0),f(R,null,F(M.value,(a,j)=>(s(),f("div",{key:`field-${a}-${j}`},[r(Je).includes(a.field_type)?x("",!0):(s(),w(Ce,{key:0},{label:o(()=>[g(m(a.display_name),1)]),default:o(()=>[a.category=="llms"&&a=="temperature"?(s(),w(Xe,{key:0,modelValue:a.value,"onUpdate:modelValue":_=>a.value=_},null,8,["modelValue","onUpdate:modelValue"])):a.field_type=="select"?(s(),w(Ie,{key:1,value:a.value,"onUpdate:value":_=>a.value=_,options:a.options},null,8,["value","onUpdate:value","options"])):a.field_type=="textarea"?(s(),w(Ve,{key:2,value:a.value,"onUpdate:value":_=>a.value=_,autoSize:!0,showCount:!0,placeholder:a.placeholder},null,8,["value","onUpdate:value","placeholder"])):a.field_type=="input"?(s(),w(De,{key:3,value:a.value,"onUpdate:value":_=>a.value=_,placeholder:a.placeholder},null,8,["value","onUpdate:value","placeholder"])):a.field_type=="number"?(s(),w(Me,{key:4,value:a.value,"onUpdate:value":_=>a.value=_,placeholder:a.placeholder},null,8,["value","onUpdate:value","placeholder"])):a.field_type=="checkbox"?(s(),w($e,{key:5,checked:a.value,"onUpdate:checked":_=>a.value=_},null,8,["checked","onUpdate:checked"])):a.field_type=="file"?(s(),w(lt,{key:6,modelValue:a.value,"onUpdate:modelValue":_=>a.value=_},null,8,["modelValue","onUpdate:modelValue"])):a.field_type=="list"?(s(),w(Qe,{key:7,modelValue:a.value,"onUpdate:modelValue":_=>a.value=_},null,8,["modelValue","onUpdate:modelValue"])):x("",!0)]),_:2},1024)),a.field_type=="typography-paragraph"?(s(),w(I,{key:1},{default:o(()=>[t(L,{span:24,class:"ui-special-item-container"},{default:o(()=>[D(t(r(ee),{source:a.value,class:"markdown-body custom-hljs ui-special-item"},null,8,["source"]),[[X]])]),_:2},1024)]),_:2},1024)):x("",!0)]))),128))]),_:1})]),_:1}),t(h),t(L,{span:24},{default:o(()=>[t(I,{gutter:[16,16]},{default:o(()=>[(s(!0),f(R,null,F(N.value,a=>(s(),w(L,{key:`node-${a.id}`,span:24},{default:o(()=>[a.type=="ButtonTrigger"?(s(),w(C,{key:0,type:"primary",block:"",onClick:ge,loading:b.value},{default:o(()=>[g(m(a.data.template.button_text.value),1)]),_:2},1032,["loading"])):a.type=="ScheduleTrigger"?(s(),w(Te,{key:1,title:r(n)("components.nodes.triggers.ScheduleTrigger.schedule_settings")},{extra:o(()=>[t(K,null,{default:o(()=>[t(C,{type:"primary",onClick:ye,loading:b.value},{default:o(()=>[g(m(r(n)("components.nodes.triggers.ScheduleTrigger.save_schedule_settings")),1)]),_:1},8,["loading"]),t(ie,{title:r(n)("workspace.workflowSpace.delete_schedule_trigger_confirm"),onConfirm:Se},{default:o(()=>[t(C,{type:"primary",danger:""},{default:o(()=>[g(m(r(n)("workspace.workflowSpace.delete")),1)]),_:1})]),_:1},8,["title"])]),_:1})]),default:o(()=>[t(Re,{modelValue:a.data.template.schedule.value,"onUpdate:modelValue":j=>a.data.template.schedule.value=j,"button-props":{type:"primary",shape:"round"},locale:r(fe)},null,8,["modelValue","onUpdate:modelValue","locale"])]),_:2},1032,["title"])):x("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1},512),[[te,!S.value]]),t(L,{xxl:S.value?24:18,xl:S.value?24:16,lg:S.value?24:14,md:24},{default:o(()=>[t(l,{level:3,style:{display:"flex","justify-content":"space-between"}},{default:o(()=>[V("span",null,[t(r(it),{fill:"#28c5e5"}),g(" "+m(r(n)("workspace.workflowSpace.outputs")),1)]),V("span",null,[t(ce,{title:r(n)("workspace.workflowSpace.maximize_output")},{default:o(()=>[D(t(r(ut),{onClick:i[2]||(i[2]=a=>S.value=!S.value)},null,512),[[te,!S.value]])]),_:1},8,["title"]),t(ce,{title:r(n)("workspace.workflowSpace.normalize_output")},{default:o(()=>[D(t(r(ct),{onClick:i[3]||(i[3]=a=>S.value=!S.value)},null,512),[[te,S.value]])]),_:1},8,["title"])])]),_:1}),t(de,{spinning:b.value},{default:o(()=>[t(I,{gutter:[16,16]},{default:o(()=>[(s(!0),f(R,null,F(T.value,(a,j)=>(s(),w(L,{span:24,class:"draggable-item",key:`node-${a.id}-${j}`},{default:o(()=>{var _;return[a.type=="Text"?(s(),f("div",ft,[t(l,{level:5},{default:o(()=>[g(m(a.data.template.output_title.value),1)]),_:2},1024),t(Ye,{text:a.data.template.text.value,renderMarkdown:a.data.template.render_markdown.value},null,8,["text","renderMarkdown"])])):a.type=="Document"?(s(),f("div",wt,[t(Z,{onClick:bt=>We(a.data.template.output.value)},{default:o(()=>[g(m(a.data.template.output.value),1)]),_:2},1032,["onClick"])])):a.type=="Audio"?(s(),f("div",vt,[t(et,{audios:[(_=a.data.template.audio_url)==null?void 0:_.value]},null,8,["audios"])])):a.type=="Mindmap"?(s(),f("div",mt,[t(tt,{content:a.data.template.content.value,style:{width:"100%","min-height":"50vh"}},null,8,["content"])])):a.type=="Mermaid"?(s(),f("div",ht,[t(at,{content:a.data.template.content.value,style:{width:"100%","min-height":"50vh"}},null,8,["content"])])):a.type=="Echarts"?(s(),f("div",gt,[t(ot,{option:a.data.template.option.value,style:{width:"100%","min-height":"50vh"}},null,8,["option"])])):(s(),f("div",yt,[a.field_type=="typography-paragraph"?(s(),f("div",St,[D(t(r(ee),{source:a.value,class:"markdown-body custom-hljs ui-special-item"},null,8,["source"]),[[X]])])):x("",!0)]))]}),_:2},1024))),128))]),_:1})]),_:1},8,["spinning"])]),_:1},8,["xxl","xl","lg"])]),_:1})]),_:1},8,["spinning"]))}}},$t=rt(Lt,[["__scopeId","data-v-68ee690c"]]);export{$t as default};
