import{c as a,A,u as ne,r as P,d as le,v as $,C as re,p as O,z as se,f as _,K as de,o as i,g as h,h as o,j as d,k as m,t as b,F as D,i as k,D as y,ar as ie,al as ce,E as ue,V as pe}from"./index-73afec2c.js";import{_ as _e}from"./UploaderFieldUse-97f91b3d.js";import{a as z,d as fe}from"./database-07243708.js";var me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M842 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 140.3-113.7 254-254 254S258 594.3 258 454c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8 0 168.7 126.6 307.9 290 327.6V884H326.7c-13.7 0-24.7 14.3-24.7 32v36c0 4.4 2.8 8 6.2 8h407.6c3.4 0 6.2-3.6 6.2-8v-36c0-17.7-11-32-24.7-32H548V782.1c165.3-18 294-158 294-328.1zM512 624c93.9 0 170-75.2 170-168V232c0-92.8-76.1-168-170-168s-170 75.2-170 168v224c0 92.8 76.1 168 170 168zm-94-392c0-50.6 41.9-92 94-92s94 41.4 94 92v224c0 50.6-41.9 92-94 92s-94-41.4-94-92V232z"}}]},name:"audio",theme:"outlined"};const be=me;function N(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(t).filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable}))),c.forEach(function(u){ge(l,u,t[u])})}return l}function ge(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}var U=function(e,t){var c=N({},e,t.attrs);return a(A,N({},c,{icon:be}),null)};U.displayName="AudioOutlined";U.inheritAttrs=!1;const ve=U;var ye={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V96c0-17.7-14.3-32-32-32zm-600 72h560v208H232V136zm560 480H232V408h560v208zm0 272H232V680h560v208zM304 240a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0zm0 272a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"database",theme:"outlined"};const ke=ye;function T(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(t).filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable}))),c.forEach(function(u){he(l,u,t[u])})}return l}function he(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}var I=function(e,t){var c=T({},e,t.attrs);return a(A,T({},c,{icon:ke}),null)};I.displayName="DatabaseOutlined";I.inheritAttrs=!1;const we=I;var Oe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-40 632H136v-39.9l138.5-164.3 150.1 178L658.1 489 888 761.6V792zm0-129.8L664.2 396.8c-3.2-3.8-9-3.8-12.2 0L424.6 666.4l-144-170.7c-3.2-3.8-9-3.8-12.2 0L136 652.7V232h752v430.2zM304 456a88 88 0 100-176 88 88 0 000 176zm0-116c15.5 0 28 12.5 28 28s-12.5 28-28 28-28-12.5-28-28 12.5-28 28-28z"}}]},name:"picture",theme:"outlined"};const De=Oe;function R(l){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},c=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(t).filter(function(u){return Object.getOwnPropertyDescriptor(t,u).enumerable}))),c.forEach(function(u){je(l,u,t[u])})}return l}function je(l,e,t){return e in l?Object.defineProperty(l,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):l[e]=t,l}var M=function(e,t){var c=R({},e,t.attrs);return a(A,R({},c,{icon:De}),null)};M.displayName="PictureOutlined";M.inheritAttrs=!1;const xe=M,Pe={class:"dataspace-container"},ze={key:1},$e={__name:"DatabaseDetail",setup(l){const{t:e}=ne(),t=P(!0),u=le().params.databaseId,E=P({}),p=$({columns:[{name:e("workspace.databaseDetail.object_title"),dataIndex:"title",key:"title"},{title:e("workspace.databaseDetail.data_type"),key:"data_type",dataIndex:"data_type"},{title:e("workspace.databaseDetail.source_url"),key:"source_url",dataIndex:"source_url"},{title:e("common.create_time"),key:"create_time",dataIndex:"create_time",sorter:!0,sortDirections:["descend","ascend"]},{title:e("common.action"),key:"action"}],data:[],loading:!1,current:1,pageSize:10,total:0,pagination:re(()=>({total:p.total,current:p.current,pageSize:p.pageSize})),handleTableChange:(g,n,w)=>{p.load({page_size:g.pageSize,page:g.current,sort_field:w.field,sort_order:w.order})},load:async g=>{p.loading=!0;const n=await z("list",{vid:u,...g});n.status==200?p.data=n.data.objects.map(w=>(w.create_time=new Date(w.create_time).toLocaleString(),w)):O.error(n.msg),p.total=n.data.total,p.pageSize=n.data.page_size,p.current=n.data.page,p.loading=!1}}),F=async()=>{p.load({});const g=await fe("get",{vid:u});g.status==200?(E.value=g.data,t.value=!1):O.error(g.msg)};se(async()=>{await F()});const r=$({open:P(!1),creating:P(!1),data:{add_method:"url",title:"",source_url:"",use_oversea_crawler:!1,files:[],content:""},create:async()=>{if(r.data.add_method=="text"&&r.data.content.length==0){O.error(e("workspace.databaseDetail.content_empty"));return}r.creating=!0,(await z("create",{vid:u,...r.data})).status===200?O.success(e("workspace.databaseDetail.create_success")):O.error(e("workspace.databaseDetail.create_failed")),p.load({}),r.creating=!1,r.open=!1}}),v=$({open:!1,loading:!1,data:{},load:async g=>{v.loading=!0,v.open=!0;const n=await z("get",{oid:g});n.status===200?v.data=n.data:O.error(e("workspace.databaseDetail.get_object_failed")),v.loading=!1}}),G=g=>{z("delete",{oid:g}).then(n=>{n.status===200?O.success(e("workspace.databaseDetail.delete_success")):O.error(e("workspace.databaseDetail.delete_failed")),p.load({})})};return(g,n)=>{const w=_("a-button"),C=_("a-radio-button"),X=_("a-radio-group"),j=_("a-form-item"),q=_("a-checkbox"),H=_("a-input"),J=_("a-textarea"),L=_("a-modal"),S=_("a-typography-text"),V=_("a-tag"),x=_("a-typography-link"),Q=_("a-divider"),W=_("a-popconfirm"),Y=_("a-table"),Z=_("a-spin"),K=_("a-card"),ee=_("a-col"),ae=_("a-row"),te=de("highlight");return i(),h("div",Pe,[a(ae,{gutter:[16,16]},{default:o(()=>[a(ee,{span:24},{default:o(()=>[a(K,{loading:t.value},{title:o(()=>[a(d(we)),m(" "+b(E.value.name),1)]),extra:o(()=>[a(w,{type:"primary",onClick:n[0]||(n[0]=s=>r.open=!0)},{default:o(()=>[m(b(d(e)("workspace.databaseDetail.add_object")),1)]),_:1}),a(L,{open:r.open,"onUpdate:open":n[7]||(n[7]=s=>r.open=s),title:d(e)("workspace.databaseDetail.add_object"),onOk:r.create,confirmLoading:r.creating},{default:o(()=>[a(j,{label:d(e)("workspace.databaseDetail.add_method")},{default:o(()=>[a(X,{value:r.data.add_method,"onUpdate:value":n[1]||(n[1]=s=>r.data.add_method=s)},{default:o(()=>[a(C,{value:"url"},{default:o(()=>[m(b(d(e)("workspace.databaseDetail.add_method_url")),1)]),_:1}),a(C,{value:"files"},{default:o(()=>[m(b(d(e)("workspace.databaseDetail.add_method_files")),1)]),_:1}),a(C,{value:"text"},{default:o(()=>[m(b(d(e)("workspace.databaseDetail.add_method_text")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),r.data.add_method=="url"?(i(),h(D,{key:0},[r.data.crawl_data_from_url?(i(),k(j,{key:0,label:d(e)("workspace.databaseDetail.use_oversea_crawler")},{default:o(()=>[a(q,{checked:r.data.use_oversea_crawler,"onUpdate:checked":n[2]||(n[2]=s=>r.data.use_oversea_crawler=s)},null,8,["checked"])]),_:1},8,["label"])):y("",!0),a(j,{label:d(e)("workspace.databaseDetail.object_source_url")},{default:o(()=>[a(H,{value:r.data.source_url,"onUpdate:value":n[3]||(n[3]=s=>r.data.source_url=s)},null,8,["value"])]),_:1},8,["label"])],64)):y("",!0),r.data.add_method=="files"?(i(),k(_e,{key:1,modelValue:r.data.files,"onUpdate:modelValue":n[4]||(n[4]=s=>r.data.files=s),multiple:!0},null,8,["modelValue"])):y("",!0),r.data.add_method=="text"?(i(),h(D,{key:2},[a(j,{label:d(e)("workspace.databaseDetail.object_title")},{default:o(()=>[a(H,{value:r.data.title,"onUpdate:value":n[5]||(n[5]=s=>r.data.title=s)},null,8,["value"])]),_:1},8,["label"]),a(j,{label:d(e)("workspace.databaseDetail.object_content")},{default:o(()=>[a(J,{value:r.data.content,"onUpdate:value":n[6]||(n[6]=s=>r.data.content=s),"auto-size":!0},null,8,["value"])]),_:1},8,["label"])],64)):y("",!0)]),_:1},8,["open","title","onOk","confirmLoading"])]),default:o(()=>[a(Y,{loading:p.loading,columns:p.columns,"data-source":p.data,pagination:p.pagination,onChange:p.handleTableChange},{headerCell:o(({column:s})=>[s.key==="title"?(i(),h(D,{key:0},[m(b(d(e)("workspace.databaseDetail.object_title")),1)],64)):y("",!0)]),bodyCell:o(({column:s,record:f})=>{var B;return[s.key==="title"?(i(),h(D,{key:0},[f.status=="PR"?(i(),k(S,{key:0,disabled:""},{default:o(()=>[m(b(f.title)+" ",1),a(d(ie))]),_:2},1024)):(i(),k(S,{key:1},{default:o(()=>[m(b(f.title),1)]),_:2},1024))],64)):s.key==="data_type"?(i(),h("span",ze,[f.data_type.toUpperCase()=="TEXT"?(i(),k(V,{key:0,color:"blue"},{default:o(()=>[a(d(ce)),m(" "+b(d(e)(`workspace.databaseDetail.data_type_${f.data_type.toUpperCase()}`)),1)]),_:2},1024)):y("",!0),f.data_type.toUpperCase()=="IMAGE"?(i(),k(V,{key:1,color:"green"},{default:o(()=>[a(d(xe)),m(" "+b(d(e)(`workspace.databaseDetail.data_type_${f.data_type.toUpperCase()}`)),1)]),_:2},1024)):y("",!0),f.data_type.toUpperCase()=="AUDIO"?(i(),k(V,{key:2,color:"purple"},{default:o(()=>[a(d(ve)),m(" "+b(d(e)(`workspace.databaseDetail.data_type_${f.data_type.toUpperCase()}`)),1)]),_:2},1024)):y("",!0)])):s.key==="source_url"?(i(),h(D,{key:2},[((B=f.source_url)==null?void 0:B.length)>0?(i(),k(x,{key:0,href:f.source_url,target:"_blank"},{default:o(()=>[m(b(d(e)("workspace.databaseDetail.source_url")),1)]),_:2},1032,["href"])):(i(),k(S,{key:1,disabled:""},{default:o(()=>[m(b(d(e)("workspace.databaseDetail.source_url")),1)]),_:1}))],64)):s.key==="action"?(i(),h(D,{key:3},[f.status!="PR"?(i(),h(D,{key:0},[a(x,{onClick:oe=>v.load(f.oid)},{default:o(()=>[m(b(d(e)("workspace.databaseDetail.check_detail_data")),1)]),_:2},1032,["onClick"]),a(Q,{type:"vertical"}),a(W,{placement:"leftTop",title:d(e)("workspace.databaseDetail.delete_confirm"),onConfirm:oe=>G(f.oid)},{default:o(()=>[a(x,{type:"danger"},{default:o(()=>[m(b(d(e)("workspace.databaseDetail.delete")),1)]),_:1})]),_:2},1032,["title","onConfirm"])],64)):y("",!0)],64)):y("",!0)]}),_:1},8,["loading","columns","data-source","pagination","onChange"]),a(L,{open:v.open,"onUpdate:open":n[8]||(n[8]=s=>v.open=s),onOk:v.create,footer:null,style:{"max-width":"1280px",width:"80vw"}},{title:o(()=>[m(b(v.data.title),1)]),default:o(()=>[a(Z,{spinning:v.loading},{default:o(()=>{var s,f;return[((s=v.data.source_url)==null?void 0:s.length)>0?(i(),k(x,{key:0,href:v.data.source_url,target:"_blank"},{default:o(()=>[m(b(d(e)("workspace.databaseDetail.source_url")),1)]),_:1},8,["href"])):y("",!0),ue(a(d(pe),{source:((f=v.data.raw_data)==null?void 0:f.text)||"",class:"custom-scrollbar markdown-body custom-hljs"},null,8,["source"]),[[te]])]}),_:1},8,["spinning"])]),_:1},8,["open","onOk"])]),_:1},8,["loading"])]),_:1})]),_:1})])}}};export{$e as default};
