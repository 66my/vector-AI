import{I as te,c as e,W as O,s as i,M as n,f as k,h as C,K as $,j as o,T as p,D as _,B as a,E as ae,F as P,G,a1 as b,_ as ne,x as le,r as re,J as se,a7 as ce,ab as ie,a9 as ue,C as V,$ as de,aa as pe}from"./index-BVaY_PMd.js";import{a as F,c as _e,u as fe,b as we}from"./userWorkflows-dXACoOKq.js";import{W as ke,I as me,R as ve}from"./RelatedWorkflowsModal-BhDC6lbk.js";import{_ as ge}from"./WorkflowRunRecordsDrawer-Bb4UKzcG.js";import{_ as z}from"./QuestionPopover-BhoTXACS.js";import{f as ye}from"./util-Dhsj7fS-.js";import{g as Ie}from"./TextOutput-DrPZOw5m.js";import"./userDatabase-DRM-v3kf.js";import"./UploaderFieldUse-BaDdCJKo.js";import"./Delete-ButkBd9H.js";import"./database-3tm-Vuvn.js";import"./Edit-UHaX9jwF.js";import"./Time-BXQ5NMLt.js";const he=te("down",!1,function(f){return e("svg",{width:f.size,height:f.size,viewBox:"0 0 48 48",fill:"none"},[e("path",{d:"M36 18L24 30L12 18",stroke:f.colors[0],"stroke-width":f.strokeWidth,"stroke-linecap":f.strokeLinecap,"stroke-linejoin":f.strokeLinejoin},null)])}),De={__name:"AgentInvokeDataEdit",props:{workflowData:{type:Object,required:!0},type:{type:String,required:!1,default:"menuItem"},block:{type:Boolean,required:!1,default:!1},workflowType:{type:String,required:!1,default:"workflow"}},setup(f){var T,E,R;const l=f,{t:r}=O(),y=i(!1),I=i(!1),u=i(l.workflowData.tool_call_data||{}),w=i([]);w.value=Object.keys(((R=(E=(T=l.workflowData)==null?void 0:T.tool_call_data)==null?void 0:E.parameters)==null?void 0:R.properties)??{}).map(m=>({key:m,value:l.workflowData.tool_call_data.parameters.properties[m],source:l.workflowData.tool_call_data.parameter_sources[m],required:l.workflowData.tool_call_data.parameters.required.includes(m)}));const x=async()=>{if(I.value=!0,!/^[a-zA-Z0-9_-]{1,64}$/.test(u.value.name)){b.error(r("components.workspace.agentInvokeDataEdit.tool_name_error")),I.value=!1;return}u.value.parameters={type:"object",properties:w.value.reduce((c,d)=>(c[d.key]=d.value,d.description&&(c[d.key].description=d.description),c),{}),required:w.value.filter(c=>c.required).map(c=>c.key)},u.value.parameter_sources=w.value.reduce((c,d)=>(c[d.key]={...d.source,required:d.required},c),{});let t={};l.workflowType=="workflow"?t=await F("update-tool-call-data",{wid:l.workflowData.wid,tool_call_data:u.value}):t=await _e("update-tool-call-data",{tid:l.workflowData.tid,tool_call_data:u.value}),t.data.status==200?(b.success(r("common.save_success")),y.value=!1):b.error(t.data.msg),I.value=!1};return(m,t)=>{const c=n("a-menu-item"),d=n("a-button"),U=n("a-input"),h=n("a-form-item"),B=n("a-textarea"),N=n("a-divider"),A=n("a-checkbox"),W=n("a-card"),v=n("a-flex"),S=n("a-form"),g=n("a-spin"),q=n("a-drawer");return k(),C("div",null,[l.type=="menuItem"?(k(),$(c,{key:"agent_invoke",onClick:t[0]||(t[0]=s=>y.value=!0)},{default:o(()=>[p(_(a(r)("components.workspace.agentInvokeDataEdit.agent_invoke")),1)]),_:1})):l.type=="button"?(k(),$(d,{key:1,block:f.block,onClick:t[1]||(t[1]=s=>y.value=!0)},{default:o(()=>[p(_(a(r)("components.workspace.agentInvokeDataEdit.agent_invoke")),1)]),_:1},8,["block"])):ae("",!0),e(q,{title:a(r)("components.workspace.agentInvokeDataEdit.agent_invoke"),open:y.value,onClose:t[4]||(t[4]=s=>y.value=!1)},{extra:o(()=>[e(d,{type:"primary",onClick:x},{default:o(()=>[p(_(a(r)("common.save")),1)]),_:1})]),default:o(()=>[e(g,{spinning:I.value},{default:o(()=>[e(S,{ref:"modifyFormRef",model:u.value,layout:"vertical"},{default:o(()=>[e(h,{name:"name",rules:[{required:!0,message:a(r)("components.workspace.agentInvokeDataEdit.tool_name_required")}]},{label:o(()=>[p(_(a(r)("components.workspace.agentInvokeDataEdit.tool_name"))+" ",1),e(z,{content:[a(r)("components.workspace.agentInvokeDataEdit.tool_name_tip")]},null,8,["content"])]),default:o(()=>[e(U,{value:u.value.name,"onUpdate:value":t[2]||(t[2]=s=>u.value.name=s),showCount:!0,placeholder:a(r)("components.workspace.agentInvokeDataEdit.tool_name_placeholder")},null,8,["value","placeholder"])]),_:1},8,["rules"]),e(h,{name:"description"},{label:o(()=>[p(_(a(r)("components.workspace.agentInvokeDataEdit.tool_description"))+" ",1),e(z,{content:[a(r)("components.workspace.agentInvokeDataEdit.tool_description_tip")]},null,8,["content"])]),default:o(()=>[e(B,{autoSize:{minRows:3,maxRows:10},value:u.value.description,"onUpdate:value":t[3]||(t[3]=s=>u.value.description=s),placeholder:a(r)("components.workspace.agentInvokeDataEdit.tool_description_placeholder")},null,8,["value","placeholder"])]),_:1}),e(N,null,{default:o(()=>[p(_(a(r)("components.workspace.agentInvokeDataEdit.parameters")),1)]),_:1}),e(v,{vertical:"",gap:"middle"},{default:o(()=>[(k(!0),C(P,null,G(w.value,s=>(k(),$(W,{title:s.key},{default:o(()=>[e(h,{label:a(r)("components.workspace.agentInvokeDataEdit.parameter_name")},{default:o(()=>[e(U,{value:s.key,"onUpdate:value":D=>s.key=D},null,8,["value","onUpdate:value"])]),_:2},1032,["label"]),e(h,{label:a(r)("components.workspace.agentInvokeDataEdit.parameter_description")},{default:o(()=>[e(U,{value:s.description,"onUpdate:value":D=>s.description=D},null,8,["value","onUpdate:value"])]),_:2},1032,["label"]),e(h,null,{default:o(()=>[e(A,{checked:s.required,"onUpdate:checked":D=>s.required=D},{default:o(()=>[p(_(a(r)("components.workspace.agentInvokeDataEdit.parameter_required")),1)]),_:2},1032,["checked","onUpdate:checked"])]),_:2},1024)]),_:2},1032,["title"]))),256))]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])]),_:1},8,["title","open"])])}}},be={key:0,class:"space-container"},We={key:1,class:"space-container"},Se={__name:"WorkflowSpaceUse",setup(f){const{t:l}=O(),r=i(!0),y=fe(),I=ce(),u=ie(),w=I.params.workflowId,x=i(!1),T=i(window.innerWidth<=768?"90vw":"60vw"),E=i([]),R=i([]),m=i([]);le(async()=>{const v=await F("get",{wid:w});if(v.status!=200){b.error(l("workspace.workflowSpace.get_workflow_failed")),await u.push({name:"WorkflowSpaceMain"});return}if(t.value=v.data,t.value.ui_design)E.value=t.value.ui_design.input_fields,R.value=t.value.ui_design.output_nodes,m.value=t.value.ui_design.trigger_nodes;else{const S=Ie(t.value),g=re(S);E.value=g.inputFields,R.value=g.outputNodes,m.value=g.triggerNodes}if(c.value=t.value,r.value=!1,I.query.rid){const g=await we("get",{rid:I.query.rid});try{B(g.data)}catch(q){console.error(q),b.error(l("workspace.workflowSpace.get_workflow_record_failed"))}}}),se(()=>{clearInterval(U.value)});const t=i({}),c=i({}),d=i(0),U=i(null),h=i(),B=W=>{h.value.setWorkflowRecord(W)},N=async()=>{(await F("delete",{wid:t.value.wid})).status==200?(b.success(l("workspace.workflowSpace.delete_success")),y.deleteUserWorkflow(t.value.wid),y.deleteUserWorkflow(t.value.wid,!0),await u.push({name:"WorkflowSpaceMain"})):b.error(l("workspace.workflowSpace.delete_failed"))},A=async()=>{await u.push({name:"WorkflowEditor",params:{workflowId:w}})};return(W,v)=>{const S=n("a-skeleton"),g=n("a-typography-title"),q=n("a-typography-text"),s=n("a-divider"),D=n("a-modal"),J=n("a-typography-link"),K=n("a-tag"),j=n("a-space"),L=n("a-menu-item"),Z=n("a-popconfirm"),H=n("a-menu"),Q=n("a-button"),X=n("a-dropdown"),Y=n("a-flex"),ee=ue("highlight");return r.value?(k(),C("div",be,[e(S,{active:""})])):(k(),C("div",We,[e(Y,{justify:"space-between",align:"flex-end"},{default:o(()=>[V("div",null,[e(g,null,{default:o(()=>[p(_(t.value.title),1)]),_:1}),e(j,null,{default:o(()=>[e(q,{type:"secondary"},{default:o(()=>[p(_(a(l)("workspace.workflowSpace.update_time",{time:a(ye)(t.value.update_time)})),1)]),_:1}),e(s,{type:"vertical"}),e(J,{onClick:v[1]||(v[1]=M=>x.value=!0)},{default:o(()=>[p(_(a(l)("workspace.workflowSpace.brief"))+" ",1),e(D,{open:x.value,title:a(l)("workspace.workflowSpace.brief"),width:T.value,footer:null,class:"introduction-modal",onCancel:v[0]||(v[0]=M=>x.value=!1)},{default:o(()=>[e(me,{images:t.value.images},null,8,["images"]),de(e(a(pe),{source:t.value.brief,class:"custom-scrollbar markdown-body custom-hljs"},null,8,["source"]),[[ee]])]),_:1},8,["open","title","width"])]),_:1}),e(ve,{workflowId:a(w)},null,8,["workflowId"]),e(s,{type:"vertical"}),(k(!0),C(P,null,G(t.value.tags,(M,oe)=>(k(),$(K,{color:M.color,key:oe},{default:o(()=>[p(_(M.title),1)]),_:2},1032,["color"]))),128))]),_:1})]),V("div",null,[e(j,null,{default:o(()=>[e(ge,{workflowId:a(w),onOpenRecord:B},null,8,["workflowId"]),e(X,null,{overlay:o(()=>[e(H,null,{default:o(()=>[(k(),$(De,{"workflow-data":c.value,type:"menuItem",key:`AgentInvokeDataEdit-${d.value}`},null,8,["workflow-data"])),e(L,{key:"edit",onClick:A},{default:o(()=>[p(_(a(l)("workspace.workflowSpace.edit")),1)]),_:1}),e(Z,{placement:"leftTop",title:a(l)("workspace.workflowSpace.delete_confirm"),onConfirm:N},{default:o(()=>[e(L,{key:"delete"},{default:o(()=>[e(q,{type:"danger"},{default:o(()=>[p(_(a(l)("workspace.workflowSpace.delete")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1})]),default:o(()=>[e(Q,null,{default:o(()=>[p(_(a(l)("workspace.workflowSpace.more_actions"))+" ",1),e(a(he))]),_:1})]),_:1})]),_:1})])]),_:1}),e(s),e(ke,{ref_key:"workflowUseRef",ref:h,workflow:t.value,isTemplate:!1},null,8,["workflow"])]))}}},je=ne(Se,[["__scopeId","data-v-8605ffc6"]]);export{je as default};
